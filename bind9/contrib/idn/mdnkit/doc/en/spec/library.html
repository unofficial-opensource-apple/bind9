<!doctype html public "-//IETF//DTD HTML 2.0//EN">
<!-- $Id: library.html,v 1.1.1.1 2003/01/10 00:47:47 bbraun Exp $ -->
<html>

<head>
<title>MDN libarary specification</title>
<meta http-equiv="Content-Type" content="text/html; charset=Shift_JIS">
</head>

<body>
<h1>MDN Library</h1>

<ul>
<li><a href="#func-overview">機能概要</a>
<li><a href="#func-overview">Function Overview</a>
<li><a href="#module-list">モジュール一覧</a>
<li><a href="#module-list">Module List</a>
<li><a href="#module-desc">モジュール詳細</a>
<li><a href="#module-desc">Details of Modules</a>
</ul>

<hr>

<h2><a name="func-overview">機能概要</a></h2>
<h2><a name="func-overview">Function Overview</a></h2>

<p>MDN ライブラリ (libmdn) は多言語ドメイン名の変換に関わる各種の処理を
実装するモジュールの集合です。このライブラリは以下のような機能を
提供します。<br>
The MDN library (libmdn) is a group of modules that provide various processing with respect to multilingual domain name conversion. This library provides the following features.

<ul>
<li>エンコーディング (コードセット) 変換 <br>
Encoding (code set) conversion
<li>文字列の正規化<br>
Normalization of character strings
<li>DNS メッセージの解析、再組み立て<br>
Analysis and reassembly of DNS messages
<li>ZLD (Zero Level Domain) のマッチング、削除、追加<br>
Matching, removal and addition of ZLD (Zero Level Domain)
<li>ローカルエンコーディングの判別<br>
Local encoding identification
<li>クライアント用設定ファイルの読み込み<br>
Loading of client configuration files


<h3>エンコーディング (コードセット) 変換</h3>
<h3>Encoding (code set) conversion</h3>

<p>文字列のエンコーディングを変換し、その結果を返します。
MDN ライブラリの内部では、文字列はすべて UTF-8 エンコーディングであるとして
取り扱われます。そこで、このモジュールは<br>
Converts character string encoding and returns the result.
Inside the MDN library, character strings are all handled as UTF-8 encoding. This module supports the following conversions.
<ul>
<li>あるエンコーディングから UTF-8 への変換<br>
Conversion from certain encoding methods to UTF-8
<li>UTF-8 からあるエンコーディングへの変換<br>
Conversion from UTF-8 to certain encoding methods
</ul>
をサポートします。

</ul>

<p>エンコーディングは大きく分けて、次の2種類があります。<br>
Encoding is roughly divided into the following two types.
<ul>
<li>アプリケーションが使用するエンコーディング (シフトJIS、EUC 等)<br>
Encoding used by applications (shift JIS, EUC, etc.)
<li>多言語ドメイン名で使用するためにデザインされた特別なエンコーディング
(UTF-5、RACE 等)<br>
Special encoding designed to be used for multilingual domain names
(UTF-5、RACE etc.)
</ul>
<p>このモジュールでは前者のエンコーディング変換のために
<em>iconv()</em> ユーティリティを使用し、後者のエンコーディング変換のためには
独自の変換関数を実装して使用しています。<br>
This module uses the <em>iconv()</em> utility for the first encoding conversion process and implements a unique conversion function for the latter encoding conversion.

<p>

<h3>文字列の正規化</h3>
<h3>Normalization of character strings</h3>

<p>与えられた文字列を正規化します。標準では次にあげる正規化をサポートします。<br>
Normalizes given character strings. The following standard normalization functions are supported.
<ul>
<li>ASCII の小文字→大文字変換
<br>Converts lowercase ASCII to uppercase ASCII
<li>ASCII の大文字→小文字変換
<br>Converts uppercase ASCII to lowercase ASCII
<li>UnicodeData.txt に従った小文字→大文字変換<br>
 Converts lowercase to uppercase as specified in UnicodeData.txt
<li>UnicodeData.txt に従った大文字→小文字変換<br>
 Converts uppercase to lowercase as specified in UnicodeData.txt
<li>Unicode Normalization Form C
<br>Unicode Normalization Form C
<li>Unicode Normalization Form KC
<br>Unicode Normalization Form KC
<li>日本語の半角かな→全角カタカナ変換<br>
 Converts single-byte Japanese katakana to double-byte katakana
<li>全角マイナス記号→半角ハイフン変換<br>
 Converts double-byte minus symbols to single-byte hyphens
<li>句点(。)、全角ピリオド(．)→ピリオド(.)変換
<br> Converts Japanese periods (。) and double-byte periods (．) to periods (.)
</ul>

<br>

<h3>DNS メッセージの解析、再組み立て<br>
 Analysis and assembly of DNS messages</h3>

<p>DNS プロキシサーバ (dnsproxy) では、クライアントから送られてきた DNS
メッセージに含まれるドメイン名に対してエンコーディング変換や正規化を行い、
その結果を DNS サーバに送ります。このために以下の機能を提供します。<br>
In the DNS proxy server (dnsproxy), encoded domain names included in DNS messages sent from the client are converted and normalized and the result is sent to the DNS server. This process is comprised of the following functions:
<ul>
<li>DNSメッセージを解析し、ドメイン名を取り出す<br>
 Analyzes DNS messages and extracts domain names
<li>変換したドメイン名を用いてDNSメッセージを再構成する<br>
 Re-constructs DNS messages using converted domain names
</ul>

<br>

<h3>ZLD (Zero Level Domain) のマッチング、削除、追加<br>
 Matching, removal and addition of ZLD (Zero Level Domain)</h3>

<p>多言語ドメイン名を識別するために ZLD を必要とする方式のために、ZLD に
関する以下の機能を提供します。<br>
To identify multilingual domain names, the following ZLD-related functions are provided:
<ul>
<li>複数の ZLD の中から、ドメイン名にマッチするものを探す<br>
 Of the multiple number of ZLDs, finds the one that matches the domain name
<li>ドメイン名から ZLD 部分を削除する<br>
 Removes the ZLD portion from the domain name
<li>ドメイン名に ZLD を追加する<br>
 Adds ZLD to the domain name
</ul>

<br>

<h3>ローカルエンコーディングの判別<br>
 Local encoding identification</h3>

<p>アプリケーションプログラムが使用しているローカルエンコーディング
(コードセット) を自動判別します。判別は基本的にはアプリケーションのロケール
情報を利用しますが、環境変数で指定することも可能になっています。<br>
Automatically identifies the local encoding (code set) used by the application program. Basically, the application locale information is used, though the local encoding (code set) can also be specified using an environmental variable.

<p>

<h3>クライアント用設定ファイルの読み込み<br>
 Loading of client configuration file</h3>

<p>アプリケーションにリンクされるリゾルバライブラリでエンコーディング
変換や正規化を行う場合、使用するエンコーディングや正規化方式は
設定ファイルに記述されます。このファイルを読み込む機能を提供します。<br>
When the resolver library linked by the application is used to perform conversion or normalization, the encoding and normalization method to be used is described in the configuration file. A function is provided to load this file.
<p>
<hr>
<h2><a name="module-list">モジュール一覧<br>
 Module list</a></h2>

<p>MDN ライブラリは以下のモジュールから構成されます。<br>
The MDN library consists of the following modules.

<dl>
<dt><a href="#brace">brace モジュール<br>brace module</a>
  <dd>ドメイン名のエンコーディング方式の一つとして提案されている BRACE
  エンコーディングの変換モジュール<br>
 Conversion module for the proposed BRACE encoding domain name encoding method
<dt><a href="#converter">converter module</a>
  <dd>文字列のエンコーディング(コードセット)の変換モジュール<br>
 Conversion module for character string encoding (code set)
<dt><a href="#debug">debug module</a>
  <dd>デバッグ用出力のためのユーティリティモジュール<br>
 Utility module for debug output
<dt><a href="#dn">dn module</a>
  <dd>DNS メッセージ内のドメイン名の展開・圧縮を行うモジュール<br>
 Extraction/compression module for domain names inside DNS messages
<dt><a href="#lace">lace module</a>
  <dd>ドメイン名のエンコーディング方式の一つとして提案されている LACE
  エンコーディングの変換モジュール<br>
 Conversion module for the proposed LACE encoding domain name encoding method
<dt><a href="#localencoding">localencoding module</a>
  <dd>アプリケーションの使用しているエンコーディングを推測するモジュール<br>
 Guesses which encoding is used by the application
<dt><a href="#log">log module</a>
  <dd>MDN ライブラリのログの出力処理を制御するモジュール<br>
 Controls MDN library log output processing
<dt><a href="#msgheader">msgheader module</a>
  <dd>DNS メッセージのヘッダの解析モジュール<br>
 Analyzes the header of the DNS message
<dt><a href="#msgtrans">msgtrans module </a>
  <dd>DNS プロキシサーバでの DNS メッセージの変換を行うためのモジュール<br>
 Converts the DNS message at the DNS proxy server
<dt><a href="#normalizer">normalizer module</a>
  <dd>文字列の正規化を行うモジュール<br>
 Normalizes character strings
<dt><a href="#race">race module</a>
  <dd>ドメイン名のエンコーディング方式の一つとして提案されている RACE
  エンコーディングの変換モジュール<br>
 Conversion module for proposed RACE domain name encoding method
<dt><a href="#res">res module</a>
  <dd>リゾルバライブラリ、あるいはアプリケーションでドメイン名の
  エンコーディング変換や正規化を行うためのインタフェースを提供するモジュール<br>
 Provides an interface to perform encoding conversion or normalization of domain names by the resolver library or application
<dt><a href="#resconf">resconf module</a>
  <dd>リゾルバライブラリ、あるいはアプリケーションでドメイン名の
  エンコーディング変換や正規化を行う際の設定ファイルを読み込むためのモジュール<br>
 Loads the configuration file used by the resolver library or application during encoding conversion and normalization of domain names
<dt><a href="#result">result module</a>
  <dd>ライブラリの各関数が返すリザルトコードを扱うモジュール<br>
 Handles the result code returned by each library function
<dt><a href="#selectiveencode">selectiveencode module</a>
  <dd>テキストの中から非ASCII文字を含むドメイン名を探し出すモジュール<br>
 Finds domain names that include non-ASCII characters
<dt><a href="#strhash">strhash module</a>
  <dd>文字列をキーとするハッシュ表を実現するモジュール<br>
 Implements a hash table that uses character strings as keys
<dt><a href="#translator">translator module</a>
  <dd>与えられたパラメータに従ってドメイン名を変換するモジュール<br>
 Converts domain name according to the specified parameters
<dt><a href="#unicode">unicode module</a>
  <dd>Unicode の各種文字属性を取得するモジュール<br>
 Obtains various Unicode character properties
<dt><a href="#unormalize">unormalize module</a>
  <dd>Unicode で定義されている標準の正規化を行うモジュール<br>
 Performs standard normalization defined by Unicode
<dt><a href="#utf5">utf5 module</a>
  <dd>ドメイン名のエンコーディング方式の一つとして提案されている UTF-5
  の基本処理を行うモジュール<br>
 Performs basic processing for the proposed UTF-5 domain name encoding method
<dt><a href="#utf8">utf8 module</a>
  <dd>UTF-8 エンコーディング文字列の基本処理を行うモジュール<br>
 Performs basic processing of UTF-8 encoding character strings
<dt><a href="#util">util module</a>
  <dd>他のモジュールで使われる共用関数を提供するモジュール<br>
 Provides common functions used by other modules
<dt><a href="#ZLDrule">ZLDrule module</a>
  <dd>ドメイン名と ZLD とのマッチングを行うモジュール<br>
 Matches domain names and ZLD
</dl>

<p>以下にモジュールの呼び出し関係図を示します。ただしほとんどすべての
モジュールから呼び出されている debug モジュールと log モジュール、また
共用関数を納めた util モジュールは割愛してあります。<br>
The following diagram shows the invoking relationship of modules. debug and log modules called by most modules and util modules that store common functions are omitted in the diagram.

<blockquote>
<img src="img/libmdn_callgraph.jpg" alt="libmdn module graph">
</blockquote>

<hr>

<h2><a name="module-desc">モジュール詳細 <br>
Details of Modules</a></h2>

<p>MDN ライブラリに含まれるすべてのモジュールについて、その仕様を記述
します。まず各モジュールで共通に使用される、関数のリターン値について
説明したあと、モジュール毎に詳細を解説します。<br>
The specifications of all modules included in MDN library are explained below.
First, return values of functions commonly used by the modules are explained and then each module is discussed in detail.

<hr>

<h3><a name="mdn_result_t">API関数のリターン値<br>
 Values returned by API functions</a></h3>

<p>MDNライブラリのほとんど全てのAPI関数は、リターン値として
列挙型である<em>mdn_result_t</em> 型の値を返します。値の一覧とその意味を
示します。<br>
Almost all API functions of the MDN library return values of <em>mdn_result_t</em>, which is an enumeration type value. The values and their meanings are explained below. <br>

<dl>
<dt><tt>mdn_success</tt>
  <dd>処理が成功したことを示します。<br>
 Processing was successful.
<dt><tt>mdn_notfound</tt>
  <dd>検索処理などにおいて、見つからなかったことを示します。<br>
The target of search processing could not be found.
<dt><tt>mdn_invalid_encoding</tt>
  <dd>エンコーディング変換において、入力された文字列のエンコーディングが間違っていることを示します。<br>
Incorrect conversion of encoded input character string.
<dt><tt>mdn_invalid_syntax</tt>
  <dd>ファイルなどの書式に間違いがあることを示します。<br>
Incorrect file format.
<dt><tt>mdn_invalid_name</tt>
  <dd>指定された名前が間違っていることを示します。<br>
 Specified name is incorrect.
<dt><tt>mdn_invalid_message</tt>
  <dd>入力されたDNSメッセージが正しくないことを示します。 <br>
Entered DNS message is incorrect.
<dt><tt>mdn_buffer_overflow</tt>
  <dd>結果を格納するバッファの大きさが足りないことを示します。<br>
 Insufficient buffer to store result.<dt><tt>mdn_noentry</tt>
  <dd>指定された項目が存在しないことを示します。<br>
 Specified item does not exist.
<dt><tt>mdn_nomemory</tt>
  <dd>メモリのアロケーションに失敗したことを示します。 <br>
Memory allocation failed.
<dt><tt>mdn_nofile</tt>
  <dd>指定されたファイルが存在しないことを示します。 <br>Specified file does not exist.
<dt><tt>mdn_nomapping</tt>
  <dd>文字列のエンコーディング(コードセット)を変換する際、変換ターゲットの文字集合に含まれない文字があった (つまり正しく変換できなかった) ことを示します。<br>
Conversion could not be performed correctly because a character in the encoded character string (code set) does not exist in the target conversion character set.
<dt><tt>mdn_context_required</tt>
  <dd>文字の大文字小文字変換の際に、正しい変換を行うには文脈情報が必要であることを示します。<br>
Indicates that context information is required to correctly convert uppercase characters to lowercase characters.
<dt><tt>mdn_failure</tt>
  <dd>上記のいずれにも当てはまらないエラーが発生したことを示します。<br>
Indicates that an error occurred that does not fall into any of the above categories.
</dl>

<hr>

<h3><a name="brace">brace モジュール <br>
brace module</a></h3>

<p>brace モジュールは、多言語ドメイン名のエンコーディング方式の一つとして提案されている<a href="../../reference/draft/draft-ietf-idn-brace-00.txt">BRACE エンコーディング</a>とUTF-8との間の変換を行うモジュールです。このモジュールは<a href="#converter">converter モジュール</a>の下位モジュールとして実装されており、アプリケーションがこのモジュールを直接呼び出すことはありません。<a href="#converter">converter モジュール</a>に対して<tt>BRACE</tt> エンコーディングとの変換を要求すると、このモジュールが間接的に呼び出されることになります。<br>
The brace module performs conversion between UTF-8 and the proposed <a href="../../reference/draft/draft-ietf-idn-brace-00.txt">BRACE encoding</a> of multilingual domain names. This module is implemented as a low-order <a href="#converter">converter module</a>, and is not directly called by the application.
When <a href="#converter">converter module</a> is requested in association with BRACE encoding conversion, this module is indirectly called.

<p>以下にモジュールの提供するAPI関数を示します。<br>
This module provides the following API functions.

<dl>

<dt><a name="mdn__brace_open">mdn__brace_open</a>
<dd>
<pre>
mdn_result_t
mdn__brace_open(mdn_converter_t ctx, mdn_converter_dir_t dir)
</pre>
<p>BRACEエンコーディングとの変換をオープンします。実際には何もしません。<br>
Opens conversion context used for BRACE encoding. Actually, this does not do anything.
<p>常に <tt>mdn_success</tt>を返します。<br>
Always returns <tt>mdn_success</tt>.
<p>

<dt><a name="mdn__brace_close">mdn__brace_close</a>
<dd>
<pre>
mdn_result_t
mdn__brace_close(mdn_converter_t ctx, mdn_converter_dir_t dir)
</pre>
<p>BRACEエンコーディングとの変換をクローズします。実際には何もしません。<br>
Closes conversion context used for BRACE encoding. Actually, this does not do anything.
<p>常に <tt>mdn_success</tt>を返します。
<br>Always returns <tt>mdn_success</tt>.
<p>

<dt><a name="mdn__brace_convert">mdn__brace_convert</a>
<dd>
<pre>
mdn_result_t
mdn__brace_convert(mdn_converter_t ctx, mdn_converter_dir_t dir,
	const char *from, char *to, size_t tolen)
</pre>
<p>BRACEエンコードされた文字列とUTF-8エンコードされた文字列の相互変換を
行います。入力文字列 <var>from</var> を変換し、結果を <var>to</var> と
<var>tolen</var> で指定される領域に書き込みます。<var>dir</var> が<tt>mdn_converter_l2u</tt>ならBRACEエンコーディングからUTF-8エンコーディングへ、<tt>mdn_converter_u2l</tt>ならUTF-8エンコーディングからBRACEエンコーディングへの変換となります。<br>
Performs bidirectional conversion of BRACE and UTF-8 encoded character strings.
The <var>from</var> input character string is converted and the result is written in the area specified by <var>to</var> and <var>tolen</var>.
When <var>dir</var> is <tt>mdn_converter_l2u</tt>, BRACE strings are converted to UTF-8 encoding and when <var>dir</var> is <tt>mdn_converter_u2l</tt>, UTF-8 strings are converted to BRACE encoding.
<p>One of the following values is returned:
<br><tt>mdn_success</tt>
<br><tt>mdn_buffer_overflow</tt>
<br><tt>mdn_invalid_encoding</tt>
<br><tt>mdn_nomemory</tt>

</dl>

<hr>

<h3><a name="converter">converter モジュール <br>
converter module</a></h3>

<p>converter モジュールは、文字列のエンコーディング(コードセット)を
変換します。MDN ライブラリは内部処理に UTF-8 エンコーディングの文字列を
使用するため、このモジュールはローカルエンコーディングと UTF-8 との
間の相互変換を行います。<br>
converter module converts character string encoding (code set). Because the MDN library uses UTF-8 character strings for internal processing, this module performs bidirectional conversion between the local encoding method and UTF-8.

<p>現在サポートされているエンコーディングは次の通りです <br>
Support is currently provided for the following encoding methods.
<ul>
<li><em>iconv()</em> がサポートしているエンコーディング<br>
    <em>iconv()</em> encoding support<br>
<br>
    iconv() とは汎用的なコードセット変換機能を提供する関数で、
    この関数がサポートするエンコーディングをサポートします。
    iconv() がサポートするエンコーディングは実装依存なので、
    具体的にどのエンコーディングが使用可能なのかは iconv() の
    ドキュメントをご覧ください。<br>
    The iconv() function provides general code set conversion functions and encoding support. The encoding methods supported by iconv() are implementation-dependent; in that regard, refer to the documentation included with iconv() for information on which encoding is actually available.
<li><tt>UTF-5</tt><br>
    多言語ドメイン名のエンコーディング方法として提案されているものです。
    詳しくは
    <a href="../../reference/draft/draft-jseng-utf5-01.txt">draft-jseng-utf5-01.txt</a>
    をご覧ください。<br>
Proposed multilingual domain name encoding method. For details, refer to
    <a href="../../reference/draft/draft-jseng-utf5-01.txt">draft-jseng-utf5-01.txt</a>

<li><tt>RACE</tt><br>
    これも多言語ドメイン名のエンコーディング方法として提案されているものです。
    詳しくは
    <a href="../../reference/draft/draft-ietf-idn-race-02.txt">draft-ietf-idn-race-02.txt</a>
    をご覧ください。<br>
Proposed multilingual domain name encoding method. For details, refer to
    <a href="../../reference/draft/draft-ietf-idn-race-02.txt">draft-ietf-idn-race-02.txt</a>

<li><tt>BRACE</tt><br>
    これも多言語ドメイン名のエンコーディング方法として提案されているものです。
    詳しくは
    <a href="../../reference/draft/draft-ietf-idn-brace-00.txt">draft-ietf-idn-brace-00.txt</a>
    をご覧ください。<br>
Proposed multilingual domain name encoding method. For details, refer to
    <a href="../../reference/draft/draft-ietf-idn-brace-00.txt">draft-ietf-idn-brace-00.txt</a>

<li><tt>LACE</tt><br>
    これも多言語ドメイン名のエンコーディング方法として提案されているものです。
    詳しくは
    <a href="../../reference/draft/draft-ietf-idn-lace-00.txt">draft-ietf-idn-lace-00.txt</a>
    をご覧ください。<br>
Proposed multilingual domain name encoding method. For details, refer to
    <a href="../../reference/draft/draft-ietf-idn-lace-00.txt">draft-ietf-idn-lace-00.txt</a>

</ul>

<p>また、converter モジュールはドメイン名のエンコーディング変換のために
特別に設計されたもので、一般的なエンコーディング変換には必ずしも適しません。
例えば UTF-5、RACE、BRACE、LACE エンコーディングはドメイン名の
区切り文字であるピリオドを特別に扱います。<br>
The converter module is specially designed for encoding conversion of domain names and is not suitable for general encoding conversion.
For example, UTF-5, RACE, BRACE, and LACE encoding provide special handling of the delimiting periods used in domain names.

<p>converter モジュールは「コード変換コンテキスト」という概念を用います。
あるエンコーディングと UTF-8 との相互変換を行うには、まず
そのエンコーディングのコード変換コンテキストを作成します。実際の
コード変換にはエンコーディングを直接指定するのではなく、この
コード変換コンテキストを指定します。コード変換コンテキストの型は
<em>mdn_converter_t</em> 型であり、次のような opaque 型として定義されています。<br>
The converter module employs the "code conversion context" concept.
When perform bidirectional conversion between a specific encoding method and UTF-8, first the code conversion context of that encoding is created. For actual code conversion, the encoding is not directly specified; instead this code conversion context is specified. The code conversion context is <em>mdn_converter_t</em> and is defined as the following opaque type.
<blockquote>
<pre>
typedef struct mdn_converter *mdn_converter_t;
</pre>
</blockquote>

<p>以下にモジュールの提供するAPI関数を示します。<br>
This module provides the following API functions.

<dl>

<dt><a name="mdn_converter_initialize">mdn_converter_initialize</a>
<dd>
<pre>
mdn_result_t
mdn_converter_initialize(void)
</pre>
<p>モジュールの初期化処理を行います。本モジュールの他のAPI関数を呼ぶ前に
 必ず呼び出してください。<br>
Initializes the module. This function is always called before calling other API functions of this module.
<p>返される値は<tt>mdn_success</tt>、<tt>mdn_nomemory</tt>のいずれかです。
<p>One of the following values is returned:
<br><tt>mdn_success</tt>
<br><tt>mdn_nomemory</tt>
<p>

<dt><a name="mdn_converter_create">mdn_converter_create</a>
<dd>
<pre>
mdn_result_t
mdn_converter_create(const char *name, mdn_converter_t *ctxp,
        int delayedopen)
</pre>
<p><var>name</var> で指定されるローカルエンコーディングと UTF-8 との間の
コード変換コンテキストを作成、初期化し、<var>ctxp</var> の指す領域に
格納します。<br>
Creates the code conversion context used for conversion between the local encoding specified by <var>name</var> and UTF-8, then initializes and stores it in the area specified by <var>ctxp</var>.
<p>ローカルエンコーディングとして、現在のところ
<tt>UTF-5</tt>、<tt>RACE</tt>、<tt>BRACE</tt>、<tt>LACE</tt>
の変換機能が用意されています。これ以外のエンコーディングが指定された場合には、システムの提供する<em>iconv()</em> ユーティリティを用いて変換が行われます。
この場合、この関数の呼び出し時に<em>iconv_open()</em> の呼び出しが行われますが、
<var>delayedopen</var> が真ならば実際に文字列の変換が行われるまで
<em>iconv_open()</em> の呼び出しが遅延されます。<br>
Currently provides <tt>UTF-5</tt>, <tt>RACE</tt>, <tt>BRACE</tt>, and <tt>LACE</tt> conversion functions.
For encoding methods other than those listed above, conversion is performed using the <em>iconv()</em> utility provided with the system.
In such a case, when this function is invoked <em>iconv_open()</em> is called. When <var>delayedopen</var> is true, calling of <em>iconv_open()</em> is delayed until the character string is actually converted.
<p>また<a href="#mdn_converter_register"><em>mdn_converter_register</em></a>
を用いて新たなローカルエンコーディングを追加することも可能です。<br>
In addition, <a href="#mdn_converter_register"><em>mdn_converter_register</em></a> can be also used to add new local encoding methods.
<p>One of the following values is returned:
<br><tt>mdn_success</tt>
<br><tt>mdn_invalid_name</tt>
<br><tt>mdn_nomemory</tt>
<br><tt>mdn_failure</tt>
<p>

<dt><a name="mdn_converter_destroy">mdn_converter_destroy</a>
<dd>
<pre>
void
mdn_converter_destroy(mdn_converter_t ctx)
</pre>
<p><a href="#mdn_converter_create"><em>mdn_converter_create</em></a> で
作成したコード変換コンテキストを削除し、確保したメモリを解放します。<br>
Deletes the code conversion context created by <a href="#mdn_converter_create"><em>mdn_converter_create</em></a> and releases the allocated memory.
<p>

<dt><a name="mdn_converter_convert">mdn_converter_convert</a>
<dd>
<pre>
mdn_result_t
mdn_converter_convert(mdn_converter_t ctx,
	mdn_converter_dir_t dir, const char *from,
	char *to, size_t tolen)
</pre>
<p><a href="#mdn_converter_create"><em>mdn_converter_create</em></a> で作成したコード変換コンテキストを用いて文字列 <var>from</var> をコード変換し、結果を <var>to</var> に格納します。<var>tolen</var> は <var>to</var> の長さです。
<var>dir</var> は変換の方向の指定で、<br>
Uses the code conversion context created by <a href="#mdn_converter_create"><em>mdn_converter_create</em></a> to perform code conversion of character strings and stores the result in <var>to</var>.
<var>tolen</var> is the length of <var>to</var>. <var>dir</var> is used to specify the direction of conversion.
<ul>
<li><tt>mdn_converter_l2u</tt>ならローカルエンコーディングから UTF-8 への変換 <br>
<tt>mdn_converter_l2u</tt> specifies the conversion method used to convert from local encoding to UTF-8.
<li><tt>mdn_converter_u2l</tt>なら UTF-8 からローカルエンコーディングへの変換 <br>
<tt>mdn_converter_u2l</tt> the conversion method used to convert from UTF-8 to the local encoding method.
</ul>
となります。

<p><tt>ISO-2022-JP</tt>のように状態をもつエンコーディングを使用した場合、
<em>iconv()</em> と異なり、この関数の呼び出し間で状態は保存されません。
変換は毎回初期状態から始まります。<br>
Unlike <em>iconv()</em>, when status-dependent encoding such as <tt>ISO-2022-JP</tt> is used, the status that is in effect when the function is called the first time is not maintained when this function is called the next time.
Conversion starts from the initial status each time.
<p>One of the following values is returned:
<br><tt>mdn_success</tt>
<br><tt>mdn_buffer_overflow</tt>
<br><tt>mdn_invalid_encoding</tt>
<br><tt>mdn_invalid_name</tt>
<br><tt>mdn_nomemory</tt>
<br><tt>mdn_failure</tt>
<p>

<dt><a name="mdn_converter_localencoding">mdn_converter_localencoding</a>
<dd>
<pre>
char *
mdn_converter_localencoding(mdn_converter_t ctx)
</pre>
<p>コード変換コンテキスト <var>ctx</var> のローカルエンコーディング名を
返します。<br>
Returns the local encoding name of the code conversion context <var>ctx</var>.
<p>

<dt><a name="mdn_converter_isasciicompatible">mdn_converter_isasciicompatible</a>
<dd>
<pre>
int
mdn_converter_isasciicompatible(mdn_converter_t ctx)
</pre>
<p>コード変換コンテキスト <var>ctx</var> のローカルエンコーディングが
ASCII互換エンコーディングかどうかを返します。ASCII互換エンコーディングなら
0でない値が、そうでないなら1が返ります。<br>
Returns whether or not the local encoding of the code conversion context <var>ctx</var>is ASCII-compatible. When the local encoding method is ASCII-compatible encoding, a value other than 0 is returned and if not, 1 is returned.
<p><a name="ACE">ASCII互換エンコーディング</a>
(<cite>ASCII-compatible Encoding</cite>) とは、そのエンコーディングでエンコードされたドメイン名が通常のASCIIのドメイン名と区別できない、つまり英数字およびハイフンのみで構成されるようなエンコーディングのことで、具体的には RACE などが相当します。これらのエンコーディングは一般にアプリケーションのローカルエンコーディングとして用いられることはありませんが、DNS プロトコル上でドメイン名を表すためのエンコーディングとしては(従来の DNS サーバ等がなんの変更もなしに使えることもあって) 有力視されているものです。<br>
<a name="ACE">ASCII-compatible encoding</a> consists of only alphenumeric characters and hyphens, meaning it is not possible to differentiate between domain names encoded using this encoding and standard ASCII domain names. Specifically, RACE encoding is of this type.
These types of encoding are not generally used for local encoding by applications but are strong candidates for the encoding used to express domain names in the DNS protocol (because conventional DNS servers can be used without modification).
<p>

<dt><a name="mdn_converter_addalias">mdn_converter_addalias</a>
<dd>
<pre>
mdn_result_t
mdn_converter_addalias(const char *alias_name, const char *real_name)
</pre>
<p>エンコーディング名 <var>real_name</var> に対して、<var>alias_name</var>
という別名を登録します。登録した別名は<a href="#mdn_converter_create"><em>mdn_converter_create</em></a> の<var>name</var> 引数に指定することができます。<br>
Used to register the alias <var>alias_name</var> for the encoding name <var>real_name</var> . Registered aliases can be specified in the var>name</var> argument of <a href="#mdn_converter_create"><em>mdn_converter_create</em></a>.
<p>返される値は
<tt>mdn_success</tt>、
<tt>mdn_nomemory</tt>
のいずれかです。
<p>One of the following values is returned:
<br><tt>mdn_success</tt>
<br><tt>mdn_nomemory</tt>
<p>

<dt><a name="mdn_converter_aliasfile">mdn_converter_aliasfile</a>
<dd>
<pre>
mdn_result_t
mdn_converter_aliasfile(const char *path)
</pre>
<p>ファイル <var>path</var> で指定されるファイルを読み込み、その内容に
従って別名を登録します。<br>
Loads the file specified by the <var>path</var> variable and registers the alias in accordance with the contents of the file.
<p>ファイル <var>path</var> は次のような単純な形式の行からなるテキストファイルです。<br>
The file <var>path</var> is a text file consisting of the following simple format.
<pre>
    別名    正式名 
    Alias   Formal name

</pre>
<p>また <tt>#</tt>で始まる行はコメントとみなされます。<br>
In addition, comment lines begin with <tt>#</tt>.
<p>返される値は
<tt>mdn_success</tt>、
<tt>mdn_nofile</tt>、
<tt>mdn_invalid_syntax</tt>、
<tt>mdn_nomemory</tt>
のいずれかです。
<p>One of the following values is returned:
<br><tt>mdn_success</tt>
<br><tt>mdn_nofile</tt>
<br><tt>mdn_invalid_syntax</tt>
<br><tt>mdn_nomemory</tt>
<p>

<dt><a name="mdn_converter_resetalias">mdn_converter_resetalias</a>
<dd>
<pre>
mdn_result_t
mdn_converter_resetalias(void)
</pre>
<p><a href="#mdn_converter_addalias"><em>mdn_converter_addalias</em></a>
や <a href="#mdn_converter_aliasfile"><em>mdn_converter_aliasfile</em></a>
で登録した別名をリセットし、別名が全く登録されていない初期状態に戻します。<br>
Resets aliases registered using <a href="#mdn_converter_addalias"><em>mdn_converter_addalias</em></a> or <a href="#mdn_converter_aliasfile"><em>mdn_converter_aliasfile</em></a> to the initial default status (where no aliases are registered).
<p>返される値は
<tt>mdn_success</tt>、
<tt>mdn_nomemory</tt>
のいずれかです。
<p>One of the following values is returned:
<br><tt>mdn_success</tt>
<br><tt>mdn_nomemory</tt>
<p>

<dt><a name="mdn_converter_register">mdn_converter_register</a>
<dd>
<pre>
mdn_result_t
mdn_converter_register(const char *name,
	mdn_converter_openproc_t open,
	mdn_converter_closeproc_t close,
	mdn_converter_convertproc_t convert,
	int ascii_compatible)
</pre>
<p><var>name</var> という名前のローカルエンコーディングと UTF-8との
間のエンコーディング変換機能を追加します。<var>open</var>、<var>close</var>、
<var>convert</var> は変換等の処理関数へのポインタです。
<var>ascii_compatible</var> にはこのローカルエンコーディングが
ASCII互換エンコーディングなら1を、そうでなければ0を指定します。<br>
Adds the encoding conversion function between the <var>name</var> local encoding method and UTF-8. <var>open</var>, <var>close</var>, and <var>convert</var> are used as pointers to processing functions such as conversion. 1 specifies <var>ascii_compatible</var> local encoding, 0 that local encoding is not ASCII compatible.
<p>返される値は
<tt>mdn_success</tt>、
<tt>mdn_nomemory</tt>
のいずれかです。
<p>One of the following values is returned:
<br><tt>mdn_success</tt> and
<br><tt>mdn_nomemory</tt>

</dl>

<hr>

<h3><a name="debug">debug モジュール <br>
debug module</a></h3>

<p>debug モジュールはデバッグ用出力のためのユーティリティモジュールです。<br>
The debug module is a utility module for debug output.

<p>以下にモジュールの提供するAPI関数を示します。<br>
This module provides the following API functions.

<dl>
<dt><a name="mdn_debug_hexstring">mdn_debug_hexstring</a>
<dd>
<pre>
char *
mdn_debug_hexstring(const char *s, int maxbytes)
</pre>
<p>文字列 <var>s</var> を16進数表示した文字列を返します。
<var>maxbytes</var> は表示する最大の長さで、<var>s</var>が これを超えた場合には
最後に <code>...</code>が追加されます。<br>
Returns a hexidecimal character string of <var>s</var> length. <var>maxbytes</var> indicates the maximum length expressed and when <var>s</var> exceeds that length, <code>...</code> is appended to the string at that point.

<p>返される文字列のメモリ領域は本関数の保持するスタティック変数のもので、その内容は本関数の次の呼び出し時まで有効です。<br>
The memory area allocated for the returned character string is used for the static variable held by this function and is in effect until the function is called the next time.
<p>

<dt><a name="mdn_debug_xstring">mdn_debug_xstring</a>
<dd>
<pre>
char *
mdn_debug_xstring(const char *s, int maxbytes)
</pre>
<p>文字列 <var>s</var> の中で、コードが128以上のものを<tt>\x{HH}</tt>形式で
表示した文字列を返します。
<var>maxbytes</var> は表示する最大の長さで、<var>s</var> がこれを超えた場合には
最後に <code>...</code>が追加されます。<br>
Of the <var>s</var> character strings, returns in <tt>\x{HH}</tt> format those character strings 128 bytes or larger.
<var>maxbytes</var> indicates the maximum length expressed and when <var>s</var> exceeds this, <code>...</code> is appended to the string at that point.
<p>返される文字列のメモリ領域は本関数の保持するスタティック変数の
もので、その内容は本関数の次の呼び出し時まで有効です。<br>
The memory area allocated for the returned character string is used for the static variable held by this function and is in effect until the function is called the next time.
<p>

<dt><a name="mdn_debug_hexdata">mdn_debug_hexdata</a>
<dd>
<pre>
char *
mdn_debug_hexdata(const char *s, int length, int maxlength)
</pre>
<p>長さ <var>length</var> のバイト列 <var>s</var> を16進表示した文字列を返します。<var>maxbytes</var> は表示する最大のバイト長で、<var>length</var> がこれを超えた場合には最後に <code>...</code>が追加されます。<br>
Returns the <var>length</var> of byte row <var>s</var> in hexadecimal character strings. <var>maxbytes</var> indicates the maximum length expressed and when <var>length</var> exceeds this, <code>...</code> is appended to the string at that point.
<p>返される文字列のメモリ領域は本関数の保持するスタティック変数のもので、その内容は本関数の次の呼び出し時まで有効です。<br>
The memory area allocated for the returned character string is used for the static variable held by this function and is in effect until the function is called the next time.
<p>

<dt><a name="mdn_debug_hexdump">mdn_debug_hexdump</a>
<dd>
<pre>
void
mdn_debug_hexdump(const char *s, int length)
</pre>
<p>長さ <var>length</var> のバイト列 <var>s</var> の16進ダンプを標準エラー出力に表示します。<br>
The standard error output is comprised of a hexidecimal dump of <var>length</var> of byte row <var>s</var>.

</dl>

<hr>

<h3><a name="dn">dn モジュール dn module</a></h3>

<p>dn モジュールは、DNS メッセージ内のドメイン名の展開・圧縮を行うモジュール
です。これはリゾルバライブラリの<em>res_comp</em> および<em>res_expand</em> に
相当する機能を提供します。<br>
The dn module expands or compresses domain names in DNS messages. This provides the functional equivalent of <em>res_comp</em> and <em>res_expand</em> in the resolver library.

<p>このモジュールは本ライブラリの他のモジュールからのみ利用されることを想定して
設計されています。<br>
This module was designed under the assumption that it would only used by only other modules in the libary.

<p>ドメイン名の圧縮の際は、次に示す<em>mdn__dn_t</em> 型のコンテキスト情報を
使用します。<br>
When a domain name is compressed, context information of type <em>mdn__dn_t</em> is used, as shown below:
<blockquote>
<pre>
#define MDN_DN_NPTRS	64
typedef struct {
	const unsigned char *msg;
	int cur;
	int offset[MDN_DN_NPTRS];
} mdn__dn_t;
</pre>
</blockquote>

<p>以下にモジュールの提供するAPI関数を示します。<br>
This module provides the following API functions.

<dl>

<dt><a name="mdn__dn_expand">mdn__dn_expand</a>
<dd>
<pre>
mdn_result_t
mdn__dn_expand(const char *msg, size_t msglen,
	const char *compressed, char *expanded,
	size_t buflen, size_t *complenp)
</pre>
<p>長さ <var>msglen</var> のDNSメッセージ <var>msg</var> 中の
圧縮されたドメイン名 <var>compressed</var> を展開し、
<var>expanded</var> に結果を格納します。
<var>buflen</var> は <var>expanded</var> の大きさです。
また、<var>compressed</var> の長さが <var>*complenp</var> に格納されます。<br>
Expands the compressed domain name in DNS message <var>msg</var> of length <var>msglen</var> and stores the result in <var>expanded</var>.
<var>buflen</var> is the size of <var>expanded</var>.
Also, the length of <var>compressed</var> is stored in <var>*complenp</var>.
<p>返される値は
<tt>mdn_success</tt>、
<tt>mdn_buffer_overflow</tt>、
<tt>mdn_invalid_message</tt>
のいずれかです。
<p>One of the following values is returned:
<br><tt>mdn_success</tt>
<br><tt>mdn_buffer_overflow</tt>
<br><tt>mdn_invalid_message</tt>
<p>

<dt><a name="mdn__dn_initcompress">mdn__dn_initcompress</a>
<dd>
<pre>
void
mdn__dn_initcompress(mdn__dn_t *ctx, const char *msg)
</pre>
<p>ドメイン名圧縮用のコンテキスト情報 <var>ctx</var> を初期化します。
この関数は<a href="#mdn__dn_compress"><em>mdn__dn_compress</em></a> を呼び出す前に必ず呼び出す必要があります。
<var>msg</var> は圧縮したドメイン名を格納するDNSメッセージの
先頭アドレスです。<br>
Initializes context information <var>ctx</var> for domain name compression.
This function must be called before calling <a href="#mdn__dn_compress"><em>mdn__dn_compress</em></a>.
<var>msg</var> is the leading address in a DNS message where the compressed domain name is stored.
<p>

<dt><a name="mdn__dn_compress">mdn__dn_compress</a>
<dd>
<pre>
mdn_result_t
mdn__dn_compress(const char *name, char *sptr, size_t length,
	mdn__dn_t *ctx, size_t *complenp)
</pre>
<p><var>name</var> の指すドメイン名を圧縮して <var>sptr</var> の指す
場所に格納します。<var>length</var> は <var>sptr</var> の空き領域の長さです。
圧縮の際は、<var>ctx</var> に入っている以前に圧縮したドメイン名の情報が
参照されます。圧縮したドメイン名の長さが <var>complenp</var> に入れられるとともに、圧縮に必要な情報が <var>ctx</var> に追加されます。<br>
Compresses the domain name indicated by <var>name</var> and stores it in the location indicated by <var>sptr</var>. <var>length</var> is the length of available space <var>sptr</var>.
When compression is performed, the previously compressed domain name information in <var>ctx</var> is referenced. The length of the compressed domain name is placed in <var>complenp</var> and also the information necessary for compression is added to <var>ctx</var>.
<p>返される値は
<tt>mdn_success</tt>、
<tt>mdn_buffer_overflow</tt>、
<tt>mdn_invalid_name</tt>
のいずれかです。
<p>One of the following values is returned:
<br><tt>mdn_success</tt>
<br><tt>mdn_buffer_overflow</tt>
<br><tt>mdn_invalid_name</tt>

</dl>

<hr>

<h3><a name="lace">lace モジュール <br>
lace module</a></h3>

<p>lace モジュールは、多言語ドメイン名のエンコーディング方式の一つとして
提案されている
<a href="../../reference/draft/draft-ietf-idn-lace-00.txt">
LACE エンコーディング</a>
とUTF-8との間の変換を行うモジュールです。このモジュールは
<a href="#converter">converter モジュール</a>の
下位モジュールとして実装されており、
アプリケーションがこのモジュールを直接呼び出すことはありません。
<a href="#converter">converter モジュール</a>に対して
<tt>LACE</tt> エンコーディング
との変換を要求すると、このモジュールが間接的に呼び出されることになります。<br>
The lace module performs conversion between UTF-8 and <a href="../../reference/draft/draft-ietf-idn-lace-00.txt"> the proposed </a>LACE</a> multilingual domain name encoding method. This module is implemented as a low-order <a href="#converter">converter module</a>, and is not directly called by the application.
When the <a href="#converter">converter module</a  > is requested for conversion with <tt>LACE</tt> encoding, this module is indirectly called.

<p>以下にモジュールの提供するAPI関数を示します。<br>
This module provides the following API functions.

<dl>

<dt><a name="mdn__lace_open">mdn__lace_open</a>
<dd>
<pre>
mdn_result_t
mdn__lace_open(mdn_converter_t ctx, mdn_converter_dir_t dir)
</pre>
<p>LACEエンコーディングとの変換をオープンします。実際には何もしません。<br>
Opens conversion context with LACE encoding. Actually, this does not do anything. 

<p>常に <tt>mdn_success</tt>を返します。<br>
Always returns <tt>mdn_success</tt>.
<p>

<dt><a name="mdn__lace_close">mdn__lace_close</a>
<dd>
<pre>
mdn_result_t
mdn__lace_close(mdn_converter_t ctx, mdn_converter_dir_t dir)
</pre>
<p>LACEエンコーディングとの変換をクローズします。実際には何もしません。<br>
Closes conversion context with LACE encoding. Actually, this does not do anything.
<p>常に <tt>mdn_success</tt>を返します。<br>
Always returns <tt>mdn_success</tt>.
<p>

<dt><a name="mdn__lace_convert">mdn__lace_convert</a>
<dd>
<pre>
mdn_result_t
mdn__lace_convert(mdn_converter_t ctx, mdn_converter_dir_t dir,
	const char *from, char *to, size_t tolen)
</pre>
<p>LACEエンコードされた文字列とUTF-8エンコードされた文字列の相互変換を
行います。
入力文字列 <var>from</var> を変換し、結果を <var>to</var> と
<var>tolen</var> で指定される領域に書き込みます。
<var>dir</var> が<tt>mdn_converter_l2u</tt>なら
LACEエンコーディングからUTF-8エンコーディングへ、<tt>mdn_converter_u2l</tt>
ならUTF-8エンコーディングからLACEエンコーディングへの変換となります。<br>
Provides bidirectional conversion between LACE character strings and UTF-8 character strings.
The <var>from</var> input character string is converted and the result is written in the area specified by <var>to</var> and <var>tolen</var>.
When <var>dir</var> is <tt>mdn_converter_l2u</tt>, LACE encoding is converted to UTF-8 encoding. When it is <tt>mdn_converter_u2l</tt>, UTF-8 encoding is converted to LACE encoding.
<p>返される値は
<tt>mdn_success</tt>、
<tt>mdn_buffer_overflow</tt>、
<tt>mdn_invalid_encoding</tt>、
<tt>mdn_nomemory</tt>
のいずれかです。
<p>One of the following values is returned:
<br><tt>mdn_success</tt>
<br><tt>mdn_buffer_overflow</tt>
<br><tt>mdn_invalid_encoding</tt>
<br><tt>mdn_nomemory</tt>

</dl>

<hr>

<h3><a name="localencoding">localencoding モジュール localencoding module</a></h3>

<p>localencoding モジュールはロケール情報を利用して、
アプリケーションの使用しているエンコーディングを推測するモジュールです。<br>
The localencoding module uses locale information to guess the encoding used by the application.

<p>以下にモジュールの提供するAPI関数を示します。<br>
This module provides the following API functions.

<dl>

<dt><a name="mdn_localencoding_name">mdn_localencoding_name</a>
<dd>
<pre>
const char *
mdn_localencoding_name(void)
</pre>
<p>現在のロケール情報を元に、アプリケーションの使用しているエンコーディング名
(<em><a href="#mdn_converter_create">mdn_converter_create()</a></em> に渡す
名前) を推測して返します。<br>
Guesses the type of encoding used by the application (the name passed to <em><a href="#mdn_converter_create">mdn_converter_create()</a></em>)and returns it based on the current locale information.
<p>推測は、システムが<em>nl_langinfo()</em> を備えていればそれを利用し、
そうでなければ<em>setlocale()</em> や環境変数の情報から行われます。
後者の場合には必ずしも正しいエンコーディング名が得られるとは限りません。<br>
To guess the type of encoding, <em>nl_langinfo()</em> is used if it is available in the the system and if not, <em>setlocale()</em> or environmental variable information is used.
In the latter case, the corrent encoding name may not be obtained.
<p>ロケール情報から正しい推測ができない場合、もしくはアプリケーションが
ロケールと異なるエンコーディングを用いて動作している場合のために、
もし環境変数 <var>MDN_LOCAL_CODESET</var> が定義されていれば、
をアプリケーションのロケールに関わらず、その変数の値をエンコーディング名として
返すようになっています。<br>
When <var>MDN_LOCAL_CODESET</var> environmental variable is defined in order to deal with situations in which the correct encoding cannot be guessed from the locale information or the application is operating using different encoding than that the locale, this module returns the value of that variable as the encoding name regardless of the application locale.

</dl>

<hr>

<h3><a name="log">log モジュール log module</a></h3>

<p>log モジュールはMDN ライブラリのログの出力処理を制御するモジュールです。
ログはデフォルトでは標準エラー出力に書き出されますが、ハンドラを登録する
ことで、別の出力方法に変更することも可能です。<br>
log module controls MDN library log output.
A standard error output log is written by default. It can, however, be changed to another output method by registering the handler.
<p>またログレベルを設定することも可能です。ログレベルは次の5段階が
定義されています。<br>
The log level can be set as well. The following five log levels are defined.
<blockquote>
<pre>
enum {
	mdn_log_level_fatal   = 0,
	mdn_log_level_error   = 1,
	mdn_log_level_warning = 2,
	mdn_log_level_info    = 3,
	mdn_log_level_trace   = 4,
	mdn_log_level_dump    = 5
};
</pre>
</blockquote>

<p>以下にモジュールの提供するAPI関数を示します。<br>
This module provides the following API functions.

<dl>

<dt><a name="mdn_log_fatal">mdn_log_fatal</a>
<dd>
<pre>
void
mdn_log_fatal(const char *fmt, ...)
</pre>
<p>fatal レベルのログを出力します。このレベルは、プログラムの実行が
不可能であるような致命的なエラーの際に用いられます。
引数は<em>printf</em> と同じ形式で指定します。<br>
Outputs a fatal level log. This level is used when a fatal error occurs that causes problems such as when program execution cannot be performed.
Arguments are specified using the same format as <em>printf</em>.
<p>

<dt><a name="mdn_log_error">mdn_log_error</a>
<dd>
<pre>
void
mdn_log_error(const char *fmt, ...)
</pre>
<p>error レベルのログを出力します。このレベルは、
致命的ではないエラーの際に用いられます。
引数は<em>printf</em> と同じ形式で指定します。<br>
Outputs the error level log. This level is used when an error occurs that is not fatal.
Arguments are specified using the same format as <em>printf</em>.
<p>

<dt><a name="mdn_log_warning">mdn_log_warning</a>
<dd>
<pre>
void
mdn_log_warning(const char *fmt, ...)
</pre>
<p>warning レベルのログを出力します。このレベルは警告メッセージを
表示するために用いられます。
引数は<em>printf</em> と同じ形式で指定します。<br>
Outputs a warning level log. This level is used to display a warning message.
Arguments are specified using the same format as <em>printf</em>.
<p>

<dt><a name="mdn_log_info">mdn_log_info</a>
<dd>
<pre>
void
mdn_log_info(const char *fmt, ...)
</pre>
<p>info レベルのログを出力します。このレベルはエラーではなく、
有用と思われる情報を出力するのに用いられます。
引数は<em>printf</em> と同じ形式で指定します。<br>
Outputs info level log. This level is not used for errors but instead to output other potentially useful information.
Arguments are specified using the same format as <em>printf</em>.

<p>

<dt><a name="mdn_log_trace">mdn_log_trace</a>
<dd>
<pre>
void
mdn_log_trace(const char *fmt, ...)
</pre>
<p>trace レベルのログを出力します。このレベルはAPI関数のトレース
情報を出力するのに用いられます。一般にライブラリのデバッグ目的以外で
このレベルのログを記録する必要はないでしょう。
引数は<em>printf</em> と同じ形式で指定します。<br>
Outputs the trace level log. This level is used to output API function trace information. Generally, this log does not need to be recorded for purposes other than debugging the library.
The arguments are specified using the same format as <em>printf</em>.
<p>

<dt><a name="mdn_log_dump">mdn_log_dump</a>
<dd>
<pre>
void
mdn_log_dump(const char *fmt, ...)
</pre>
<p>dump レベルのログを出力します。このレベルはさらにデバッグ用の
パケットデータダンプなどを出力するのに用いられます。
一般にライブラリのデバッグ目的以外でこのレベルのログを記録する
必要はないでしょう。
引数は <em>printf</em> と同じ形式で指定します。<br>
Outputs the dump level log. This level is used to output additional packet data dump for debugging.
Generally, this level of log does not need to be recorded for purposes other than debugging the library.
The arguments are specified using the same format as for <em>printf</em>.
<p>

<dt><a name="mdn_log_setlevel">mdn_log_setlevel</a>
<dd>
<pre>
void
mdn_log_setlevel(int level)
</pre>
<p>ログ出力のレベルを設定します。設定したレベルを超えるレベルの
ログは出力されません。この関数でログレベルを設定しない場合、
環境変数 <tt>MDN_LOG_LEVEL</tt> に設定された整数値が使用されます。<br>
Sets the level of log output. Logs higher than the set level are not output. When the log level is not specified with this function, the integer value set to the <tt>MDN_LOG_LEVEL</tt> environmental variable is used.
<p>

<dt><a name="mdn_log_getlevel">mdn_log_getlevel</a>
<dd>
<pre>
int
mdn_log_getlevel(void)
</pre>
<p>現在のログ出力のレベルを表す整数値を取得して返します。<br>
Obtains and returns the integer value for the current level of log output.
<p>

<dt><a name="mdn_log_setproc">mdn_log_setproc</a>
<dd>
<pre>
void
mdn_log_setproc(mdn_log_proc_t proc)
</pre>
<p>ログの出力ハンドラを設定します。<var>proc</var> はハンドラ関数への
ポインタです。もしハンドラを指定しない場合、あるいは <var>proc</var> に
NULL を指定した場合には、ログは標準エラー出力に出力されます。<br>
Used to set the log output handler. <var>proc</var> is a pointer to the handler function. When the handler is not specified or NULL is specified for <var>proc</var>, a standard error log is output.
<p>ハンドラの型 <tt>mdn_log_proc_t</tt> は次のように定義されています。<br>
The <tt>mdn_log_proc_t</tt> handler type is defined as follows.
<blockquote>
<pre>
typedef void  (*mdn_log_proc_t)(int level, const char *msg);
</pre>
</blockquote>
<var>level</var> にはログのレベルが、また <var>msg</var> には表示すべき
メッセージ文字列が渡されます。<br>
The log level is passed to <var>level</var> and the message character string that should be displayed is passed to <var>msg</var>.

</dl>

<hr>

<h3><a name="msgheader">msgheader モジュール msgheader module</a></h3>

<p>msgheader モジュールはDNS メッセージのヘッダの解析、および組み立てを
行うモジュールです。<br>
msgheader module analyses and assembles the DNS message header.
<p>解析されたヘッダ情報は、次に示す構造体に入ります。各フィールドは
DNS メッセージヘッダのフィールドにそのまま対応しているので、説明は省略します。<br>
Analyzed header information is placed in the following structure. Since each field corresponds to a field of DNS message header, the explanation is omitted here.
<blockquote>
<pre>
typedef struct mdn_msgheader {
	unsigned int id;
	int qr;
	int opcode;
	int flags;
	int rcode;
	unsigned int qdcount;
	unsigned int ancount;
	unsigned int nscount;
	unsigned int arcount;
} mdn_msgheader_t;
</pre>
</blockquote>

<p>以下にモジュールの提供するAPI関数を示します。<br>
This module provides the following API functions.

<dl>

<dt><a name="mdn_msgheader_parse">mdn_msgheader_parse</a>
<dd>
<pre>
mdn_result_t
mdn_msgheader_parse(const char *msg, size_t msglen,
	mdn_msgheader_t *parsed)
</pre>
<p><var>msg</var> と <var>msglen</var> で示されるDNSメッセージのヘッダを
解析し、<var>parsed</var> が示す構造体に格納します。<br>
Analyses the DNS message headers indicated by <var>msg</var> and <var>msglen</var> and stores the information in the structure indicated by <var>parsed</var>.
<p>返される値は
<tt>mdn_success</tt>、
<tt>mdn_invalid_message</tt>
のいずれかです。
<p>One of the following values is returned:
<br><tt>mdn_success</tt>
<br><tt>mdn_invalid_message</tt>
<p>

<dt><a name="mdn_msgheader_unparse">mdn_msgheader_unparse</a>
<dd>
<pre>
mdn_result_t
mdn_msgheader_unparse(mdn_msgheader_t *parsed,
	char *msg, size_t msglen)
</pre>
<p>この関数は<em><a href="#mdn_msgheader_parse">mdn_msgheader_parse</a></em> の
逆の処理を行います。つまり、<var>parsed</var> で指定された構造体のデータから
DNSメッセージのヘッダを構成し、<var>msg</var> と <var>msglen</var> で
示される領域に格納します。<br>
This function performs reverse processing of <em><a href="#mdn_msgheader_parse">mdn_msgheader_parse</a></em>, in which the DNS message header is structured from the structure data specified by <var>parsed</var>, after which it is stored in the area specified by <var>msg</var> and <var>msglen</var>.

<p>返される値は
<tt>mdn_success</tt>、
<tt>mdn_buffer_overflow</tt>
のいずれかです。
<p>One of the following values is returned:
<br><tt>mdn_success</tt>
<br><tt>mdn_buffer_overflow</tt>
<p>

<dt><a name="mdn_msgheader_getid">mdn_msgheader_getid</a>
<dd>
<pre>
unsigned int
mdn_msgheader_getid(const char *msg)
</pre>
<p><var>msg</var> で指定されるDNSメッセージから ID を取り出して返します。
この関数はヘッダ全体を解析せずにIDだけ取り出したいときに便利です。
この関数は、<var>msg</var> の指すデータがDNSメッセージのヘッダ長以上ある
ことを仮定していますので、必ず呼び出し側で確認してから呼び出すように
してください。<br>
Extracts the ID from the DNS message specified by <var>msg</var> and returns it.
This function is only useful for extracting the ID without analyzing the entire header.
Since this function assumes the data indicated by <var>msg</var> is longer than the DNS message header length, always call the function after confirmation at the calling side.
<p>

<dt><a name="mdn_msgheader_setid">mdn_msgheader_setid</a>
<dd>
<pre>
void
mdn_msgheader_setid(char *msg, unsigned int id)
</pre>
<p><var>msg</var> で指定されるDNSメッセージに <var>id</var> で指定される
ID を設定します。
この関数も <var>msg</var> の指すデータがDNSメッセージのヘッダ長以上ある
ことを仮定していますので、必ず呼び出し側で確認してから呼び出すように
してください。<br>
Sets the ID specified by <var>id</var> in the DNS message specified by <var>msg</var>.
Since this function also assumes that the data indicated by <var>msg</var> is longer than the DNS message header length, always call the function after confirmation at the calling side.

</dl>

<hr>

<h3><a name="msgtrans">msgtrans モジュール <br>
msgtrans module</a></h3>

<p>msgtrans モジュールはDNS プロキシサーバでの DNS メッセージの変換処理の
大部分を提供するモジュールです。このモジュールは
<a href="#converter">converter モジュール</a>や
<a href="#normalizer">normalizer モジュール</a>など他の多くのモジュールを
の上位モジュールとして実現されています。<br>
The msgtrans module provides a large portion of DNS message conversion processing performed by the DNS proxy server. This module is implemented as a high-order module for many other modules including the <a href="#converter">converter module</a> and <a href="#normalizer">normalizer module</a>.

<p>DNSプロキシサーバにおけるメッセージ変換処理はおよそ次のようなものです。<br>
Message conversion processing by the DNS proxy server is briefly explained below.
<p>まずクライアントからDNSサーバへのメッセージの変換の場合は次の
ようになります。<br>
Conversion of a message from a client to the DNS server is as follows.
<ol>
<li>クライアントから受信したリクエストメッセージを解析し、
  クライアント側の ZLD およびエンコーディングを判定します。<br>
Request message received from client is analyzed and ZLD and encoding at the client side are determined.
<li>判定結果を用いて、ドメイン名からZLDを除去し、エンコーディングをUTF-8に
  変換します。<br>
Based on the determination result, ZLD are removed from domain names and encoding is converted to UTF-8.
<li>正規化処理を行います。<br>
Normalization processing is performed.
<li>エンコーディングを UTF-8からDNSサーバ側で用いられるエンコーディングに
  変換し、ZLDを付加します。<br>
The encoding is converted from UTF-8 to the encoding method used by the DNS server side and ZLD are added.
<li>以上の処理をメッセージに含まれるすべてのドメイン名に対して行い、
  変換結果を再び DNS メッセージ形式にまとめて DNS サーバに送信します。<br>
The above processing is performed on all domain names included in the message and the conversion results are collectively placed in the DNS message format and then sent to the DNS server.
</ol>

<p>次にDNSサーバからクライアントへのメッセージの変換の場合は次の
ようになります。<br>
Conversion of messages from the DNS server to the client is as follows.
<ol>
<li>DNSサーバから受信したリプライメッセージを解析し、
  含まれているすべてのドメイン名に対して、ZLDの除去、UTF-8エンコーディング
  への変換を行います。<br>
The reply message received from the DNS server is analyzed and removal of ZLD and conversion to UTF-8 encoding are performed on all domain names included in the message.
<li>さらにクライアント側エンコーディングに変換し、ZLDを付加します。<br>
Encoding is converted to the client side encoding and ZLD are added.
<li>変換結果を再び DNS メッセージ形式にまとめてクライアントに送信します。<br>
The conversion results are collectively placed in the DNS message format and then sent to the client.
</ol>

<p>このように、DNSメッセージの変換に際しては、
クライアント・サーバ側のZLD、エンコーディング等
いろいろなパラメータが必要となります。API関数にこれらを指定する際、
それぞれを別々の引数で指定するのは煩雑なので、次のような構造体を
用いてまとめて渡すようにしてあります。<br>
As explained above, various parameters with respect to ZLD at the client/server side and encoding are necessary for DNS message conversion. When specifying those parameters for API functions, it is troublesome to specify them using different arguments for various functions. To avoid this, the following structure can be used to pass the parameters collectively.
<blockquote>
<pre>
typedef struct mdn_msgtrans_param {
	int use_local_rule;
	mdn_ZLDrule_t local_rule;
	mdn_converter_t local_converter;
	mdn_converter_t local_alt_converter;
	char *local_ZLD;
	mdn_converter_t target_converter;
	mdn_converter_t target_alt_converter;
	char *target_ZLD;
	mdn_normalizer_t normalizer;
} mdn_msgtrans_param_t;
</pre>
</blockquote>
<p><tt>use_local_rule</tt>は、入力側のメッセージのZLDおよびエンコーディングの
判定方法を指定します。<br>
<tt>use_local_rule</tt> specifies the ZLD and encoding determination method fr the message at the input side.
<p>もし値が真ならば、これらは<tt>local_rule</tt>で
指定されるZLDとエンコーディングの集合とメッセージに含まれるドメイン名の
マッチング処理を行い、マッチしたものが使われます。
これはクライアントからDNSサーバへのリクエストメッセージの変換の際に
用いられます。
この場合、判定結果が<tt>local_converter</tt>と<tt>local_ZLD</tt>に
代入されます。<br>
When the value is true, matching processing is performed on the ZLD and encoding as specified by <tt>local_rule</tt> and the domain names included in the message, and the matches are used when converting the request message from the client to the DNS server; in this case, the judgement results are assigned to <tt>local_converter</tt> and <tt>local_ZLD</tt>.
<p>一方、<tt>local_rule</tt>が偽ならばZLDおよびエンコーディングは
<tt>local_converter</tt>と<tt>local_ZLD</tt>で指定されるものがそのまま
使用されます。
これはDNSサーバからクライアントへのリクエストメッセージの変換の際に
用いられます。
この場合<tt>local_rule</tt>の値は使用されません。<tt>use_local_rule</tt> の値に関わらず、<tt>local_alt_converter</tt> は入力側メッセージの代替エンコーディングとして使用されます。代替エンコーディングがない場合には NULL を指定します。<br>
On the other hand, if <tt>local_rule</tt> is false, the ZLD and encoding specified by <tt>local_converter</tt> and <tt>local_ZLD</tt> are used as is when converting the request message sent from DNS server to the client; in this case, the value of <tt>local_rule</tt> is not used.
Regardless of the value of <tt>use_local_rule</tt>, <tt>local_alt_converter</tt> defines the alternate encoding method used to encode the message at the input side.
When there is no alternate encoding, NULL is specified.
<p><tt>target_converter</tt> and <tt>target_ZLD</tt> are used to specify the output side encoding and ZLD.
<tt><tt>target_converter</tt>と<tt>target_ZLD</tt>で出力側の
エンコーディングとZLDを指定します。
<tt>target_alt_converter</tt>は、<tt>target_converter</tt>による
出力側のエンコーディングへの変換が、変換しようとするドメイン名に
出力側の文字集合にない文字が含まれていたために失敗した場合に、
<tt>target_converter</tt>の代わりに使用されます。
なお <tt>local_alt_converter</tt> と <tt>target_alt_converter</tt>
に対応するエンコーディングはいずれも
<a href="#ACE">ASCII 互換エンコーディング</a>でなければなりません。<br>
target_alt_converter</tt> is alternately used with <tt>target_converter</tt> when the conversion by <tt>target_converter</tt> to the output side encoding fails because the domain name to be converted includes characters that do not exist in the output side character set. Note that the encoding corresponding to <tt>local_alt_converter</tt> and <tt>target_alt_converter</tt> must be <a href="#ACE">ASCII-compatible encoding</a>, respectively.
<p><tt>normalizer</tt>は正規化方式を指定します。<br>
<tt>normalizer</tt> specifies normalization method.

<p>以下にモジュールの提供するAPI関数を示します。<br>
This module provides the following API functions.

<dl>
<dt><a name="mdn_msgtrans_translate">mdn_msgtrans_translate</a>
<dd>
<pre>
mdn_result_t
mdn_msgtrans_translate(mdn_msgtrans_param_t *param,
	const char *msg, size_t msglen,
	char *outbuf, size_t outbufsize,
	size_t *outmsglenp)
</pre>
<p><var>msg</var> および <var>msglen</var> で指定されるDNSメッセージを
変換パラメータ <var>param</var> にしたがって変換し、結果を
<var>outbuf</var> および <var>outbufsize</var> で示される領域に格納します。
<var>outmsglenp</var> には変換結果のメッセージ長が格納されます。<br>
Converts the DNS messages specified by <var>msg</var> and <var>msglen</var> according to the conversion parameter <var>param</var> and stores the result in the area indicated by <var>outbuf</var> and <var>outbufsize</var>. The message length of the conversion result is stored in <var>outmsglenp</var>.
<p>返される値は
<tt>mdn_success</tt>、
<tt>mdn_invalid_message</tt>、
<tt>mdn_invalid_encoding</tt>、
<tt>mdn_buffer_overflow</tt>
のいずれかです。
<p>One of the following values is returned:
<br><tt>mdn_success</tt>
<br><tt>mdn_invalid_message</tt>
<br><tt>mdn_invalid_encoding</tt>
<br><tt>mdn_buffer_overflow</tt>

</dl>

<hr>

<h3><a name="normalizer">normalizer モジュール <br>
normalizer module</a></h3>

<p>normalizer モジュールは文字列の正規化を行うモジュールです。
正規化の方式としては現在次のものが用意されています。
また別の新たな正規化方式を追加登録するためのAPIも用意されています。<br>
normalizer module normalizes character string.
The following normalization methods are currently provided.
In addition, API used to additionally register new normalization method is provided.
<ul>
<li><tt>ascii-uppercase</tt><br>
    ASCII の小文字から大文字への変換 <br>
    Converts ASCII lowercase to uppercase
<li><tt>ascii-lowercase</tt><br>
    ASCII の大文字から小文字への変換<br>
    Converts ASCII uppercase to lowercase
<li><tt>unicode-uppercase</tt><br>
    Unicode の文字属性を規定した
    <a href="http://www.unicode.org/unicode/reports/tr21"><cite>Case Mappings</cite></a>
    に記述されている小文字大文字マッピングに従った小文字から大文字への変換 <br>
Converts lowercase to uppercase in accordance with the lowercase/uppercase mapping described in <a href="http://www.unicode.org/unicode/reports/tr21"><cite>Case Mappings</cite></a> that prescribes character properties of Unicode.
<li><tt>unicode-lowercase</tt><br>
    上記と同じ文書にしたがった大文字から小文字への変換 <br>
Converts uppercase to lowercase in accordance with the same above document.
<li><tt>unicode-form-c</tt><br>
Unicode の正規化方式を規定した
    <a href="http://www.unicode.org/unicode/reports/tr15"><cite>Unicode Normalization Forms</cite></a>
    に記述されている<em>Normaliztion form C</em> に従う正規化 <br>
Normalizes characters in accordance with <em>Normaliztion form C</em> described in <a href="http://www.unicode.org/unicode/reports/tr15"><cite>Unicode Normalization Forms</cite></a> that prescribes normalization method of Unicode.
<li><tt>unicode-form-kc</tt><br>
同文書に記述されている <em>Unicode Normalization Form KC</em> に
    従う正規化 <br>
    Normalizes characters in accordance with <em>Unicode Normalization Form KC</em> described in the above same document.
<li><tt>ja-kana-fullwidth</tt><br>
    日本語の半角かなから全角カタカナへの変換 <br>
Converts Japanese single-byte katakana to double-byte katakana.
<li><tt>ja-fullwidth</tt><br>
    <tt>ja-kana-fullwidth</tt> と同じ。
    これは以前のバージョンとの互換性のために残されているもので、
    将来のバージョンではなくなる可能性があります。<tt>ja-kana-fullwidth</tt>
    を使ってください。<br>
Same as <tt>ja-kana-fullwidth</tt>.
    This is kept for compatibility with the previous version and may be eliminated in the future version. Use <tt>ja-kana-fullwidth</tt>.
<li><tt>ja-alnum-halfwidth</tt><br>
    日本語の全角英数字および全角マイナス記号を半角文字に変換 <br>
Converts Japanese double-byte alphanumeric characters and double-byte minus symbol to single-byte characters
<li><tt>ja-compose-voiced-sound</tt><br>
    日本語の全角かなとそれに続く濁点(゛)半濁点(゜)を
    濁点・半濁点つきのかな1文字に変換 <br>
Converts Japanese double-byte katakana and following voiced consonant mark (゛) and circle attached to certain katakana (゜) to one katakana character attached with voiced consonant mark or circle.
<li><tt>ja-minus-hack</tt><br>
    日本語の全角マイナス記号(−)からハイフン(<tt>-</tt>)への変換 <br>
Converts Japanese double-byte minus symbol (−) to hyphen(-). 
<li><tt>ja-delimiter-hack</tt><br>
    句点(。)および全角ピリオド(．)からピリオド(<tt>.</tt>)への変換 <br>
Converts Japanese period (。) and double-byte period (．) to period (<tt>.</tt>).
</ul>
<p>最後の<tt>ja-delimiter-hack</tt>は句点および全角ピリオドを
ドメイン名のセパレータであるピリオドと見なすようにするもので、
これは本来多言語ドメイン名のユーザ入力の際の手間および間違いを軽減するために
用意されたものですが、ブラウザによってはピリオドのないドメイン名が
ドメイン名ではなくキーワードと認識されてしまうなどの問題があり、
またこれはドメイン名の正規化の範囲を逸脱しているとも考えられるので、
できるだけこの正規化方式の使用は避けるべきです。<br>
The last <tt>ja-delimiter-hack</tt> is to assume Japanese period and double-byte period as the period that is the separator of domain name. This is originally provided to reduce steps or mistakes when user enters multilingual domain names. However, depending on browser, there are problems that domain names without period are recognized as keyword not domain name and also this method is supposed to exceed the scope of normalization of domain names, therefore, use of this normalization method should be avoided as much as possible.

<p>正規化方式は複数併用することも可能で、この場合指定した順に適用されます。<br>
More than one normalization methods can be used and they are applied in the order they were specified.
<p>normalizer モジュールは「正規化コンテキスト」という概念を用います。
正規化を行うに先立ってまず正規化コンテキストを作成し、使用する正規化方式をコンテキストに登録しておきます。実際の正規化処理の際には正規化方式ではなく、この正規化コンテキストを指定します。正規化コンテキストの型は<em>mdn_normalizer_t</em> 型であり、次のような opaque 型として定義されています。<br>
normalizer module uses the concept "normalization context". Prior to normalization, a normalization context is created and the normalization method to be used is registered in the context. For actual normalization procesesing, not the normalization method but this normalization context is specified. The type of normalization context is <em>mdn_normalizer_t</em> type and defined as the following opaque type.
<blockquote>
<pre>
typedef struct mdn_normalizer *mdn_normalizer_t;
</pre>
</blockquote>

<p>以下にモジュールの提供するAPI関数を示します。<br>
This module provides the following API functions.

<dl>

<dt><a name="mdn_normalizer_initialize">mdn_normalizer_initialize</a>
<dd>
<pre>
mdn_result_t
mdn_normalizer_initialize(void)
</pre>
<p>モジュールの初期化処理を行います。本モジュールの他のAPI関数を呼ぶ前に
 必ず呼び出してください。<br>
Initializes module. Make sure to call this function before calling other API function of this module.
<p>返される値は
<tt>mdn_success</tt>、
<tt>mdn_nomemory</tt>
のいずれかです。
<p>One of the following values is returned:
<br><tt>mdn_success</tt>
<br><tt>mdn_nomemory</tt>
<p>

<dt><a name="mdn_normalizer_create">mdn_normalizer_create</a>
<dd>
<pre>
mdn_result_t
mdn_normalizer_create(mdn_normalizer_t *ctxp)
</pre>
<p>正規化用の空のコンテキストを作成し、<var>ctxp</var> の指す領域に格納します。
返されるコンテキストは空で、正規化方式は一つも含まれていません。
正規化方式を追加するには
<a href="#mdn_normalizer_add"><em>mdn_normalizer_add</em></a> を用います。<br>
Creates an empty content for normalization and stores it in the area specified by <var>ctxp</var>.
The returned content is empty and does not contain any normalization methods.
To add normalization method, <a href="#mdn_normalizer_add"><em>mdn_normalizer_add</em></a> is used.
<p>返される値は
<tt>mdn_success</tt>、
<tt>mdn_nomemory</tt>
のいずれかです。
<p>One of the following values is returned:
<br><tt>mdn_success</tt>
<br><tt>mdn_nomemory</tt>
<p>

<dt><a name="mdn_normalizer_destroy">mdn_normalizer_destroy</a>
<dd>
<pre>
void
mdn_normalizer_destroy(mdn_normalizer_t ctx)
</pre>
<p><a href="#mdn_normalizer_create"><em>mdn_normalizer_create</em></a> で
作成した正規化コンテキストを削除し、アロケートされたメモリを解放します。<br>
Deletes the normalization context created by <a href="#mdn_normalizer_create"><em>mdn_normalizer_create</em></a> and releases the allocated memory.
<p>

<dt><a name="mdn_normalizer_add">mdn_normalizer_add</a>
<dd>
<pre>
mdn_result_t
mdn_normalizer_add(mdn_normalizer_t ctx, const char *scheme_name)
</pre>
<p><a href="#mdn_normalizer_create"><em>mdn_normalizer_create</em></a> で
作成した正規化コンテキストに、<var>scheme_name</var> で指定される
正規化方式を追加します。一つのコンテキストに複数の正規化方式を
追加することができます。<br>
Adds the normalization method specified by <var>scheme_name</var> in the normalization context created by <a href="#mdn_normalizer_create"><em>mdn_normalizer_create</em></a>. More than one normalization methods can be specified in one context.
<p>返される値は
<tt>mdn_success</tt>、
<tt>mdn_invalid_name</tt>、
<tt>mdn_nomemory</tt>
のいずれかです。
<p>One of the following values is returned:
<br><tt>mdn_success</tt>
<br><tt>mdn_invalid_name</tt>
<br><tt>mdn_nomemory</tt>
<p>

<dt><a name="mdn_normalizer_normalize">mdn_normalizer_normalize</a>
<dd>
<pre>
mdn_result_t
mdn_normalizer_normalize(mdn_normalizer_t ctx,
	const char *from, char *to, size_t tolen)
</pre>
<p>UTF-8 でエンコードされた文字列 <var>from</var> に <var>ctx</var> で
指定される正規化方式を適用し、その結果を <var>to</var> と <var>tolen</var> で
指定される領域に書き込みます。
<var>ctx</var> に複数の正規化方式が含まれている場合、それらが
<a href="#mdn_normalizer_add"><em>mdn_normalizer_add</em></a> で追加した順番に
適用されます。<br>
Applies the normalization method specified by <var>ctx</var> to the character strings encoded by UTF-8 <var>from</var> and writes the result in the area specified by <var>to</var> and <var>tolen</var>.
When more than one normalization method is included in <var>ctx</var>, they are applied in the order they were added by <a href="#mdn_normalizer_add"><em>mdn_normalizer_add</em></a>.
<p>返される値は
<tt>mdn_success</tt>、
<tt>mdn_invalid_encoding</tt>、
<tt>mdn_nomemory</tt>
のいずれかです。
<p>One of the following values is returned:
<br><tt>mdn_success</tt>
<br><tt>mdn_invalid_encoding</tt>
<br><tt>mdn_nomemory</tt>
<p>

<dt><a name="mdn_normalizer_register">mdn_normalizer_register</a>
<dd>
<pre>
mdn_result_t
mdn_normalizer_register(const char *scheme_name,
	mdn_normalizer_proc_t proc)
</pre>
<p>新しい正規化方式を <var>scheme_name</var> という名前で登録します。
<var>proc</var> はその正規化方式の処理関数へのポインタです。<br>
New normalization methods are registered in <var>scheme_name</var>.<var>proc</var> is a pointer to the processing function of that normalization method.
<p>返される値は
<tt>mdn_success</tt>、
<tt>mdn_nomemory</tt>
のいずれかです。
<p>One of the following values is returned:
<br><tt>mdn_success</tt>
<br><tt>mdn_nomemory</tt>

</dl>

<hr>

<h3><a name="race">race モジュール <br>
race module</a></h3>

<p>race モジュールは、多言語ドメイン名のエンコーディング方式の一つとして
提案されている
<a href="../../reference/draft/draft-ietf-idn-race-02.txt">RACE エンコーディング</a>
とUTF-8との間の変換を行うモジュールです。このモジュールは
<a href="#converter">converter モジュール</a>の下位モジュールとして実装されており、
アプリケーションがこのモジュールを直接呼び出すことはありません。
<a href="#converter">converter モジュール</a>に対して <tt>RACE</tt> エンコーディング
との変換を要求すると、このモジュールが間接的に呼び出されることになります。<br>
The race module performs conversion between UTF-8 and the proposed <a href="../../reference/draft/draft-ietf-idn-race-02.txt">RACE</a> multilingual domain name  method. This module is implemented as a low-order module of <a href="#converter">converter module</a> and is not directly called by the application. When <a href="#converter">converter module</a> is requested for conversion with <tt>RACE</tt> encoding, this module is indirectly called.

<p>以下にモジュールの提供するAPI関数を示します。<br>
This module provides the following API functions.

<dl>

<dt><a name="mdn__race_open">mdn__race_open</a>
<dd>
<pre>
mdn_result_t
mdn__race_open(mdn_converter_t ctx, mdn_converter_dir_t dir)
</pre>
<p>RACEエンコーディングとの変換をオープンします。実際には何もしません。<br>
Opens conversion context with RACE encoding. Actually, this does not do anything.
<p>常に <tt>mdn_success</tt>を返します。<br>
Always returns <tt>mdn_success</tt>.
<p>

<dt><a name="mdn__race_close">mdn__race_close</a>
<dd>
<pre>
mdn_result_t
mdn__race_close(mdn_converter_t ctx, mdn_converter_dir_t dir)
</pre>
<p>RACEエンコーディングとの変換をクローズします。実際には何もしません。<br>
Closes conversion context with RACE encoding. Actually, this does not do anything.
<p>常に <tt>mdn_success</tt>を返します。<br>
Always returns <tt>mdn_success</tt>.
<p>

<dt><a name="mdn__race_convert">mdn__race_convert</a>
<dd>
<pre>
mdn_result_t
mdn__race_convert(mdn_converter_t ctx, mdn_converter_dir_t dir,
	const char *from, char *to, size_t tolen)
</pre>
<p>RACEエンコードされた文字列とUTF-8エンコードされた文字列の相互変換を
行います。
入力文字列 <var>from</var> を変換し、結果を <var>to</var> と
<var>tolen</var> で指定される領域に書き込みます。
<var>dir</var> が<tt>mdn_converter_l2u</tt>なら
RACEエンコーディングからUTF-8エンコーディングへ、<tt>mdn_converter_u2l</tt>
ならUTF-8エンコーディングからRACEエンコーディングへの変換となります。<br>
Performs bidirectional conversion between RACE-encoded and UTF-8 encoded character strings. Converts the <var>from</var> input character string and writes the result in the area specified by <var>to</var> and <var>tolen</var>.
When <var>dir</var> is <tt>mdn_converter_l2u</tt>, RACE encoding is converted to UTF-8 encoding. When it is <tt>mdn_converter_u2l</tt>, UTF-8 encoding is converted to RACE encoding.
<p>返される値は
<tt>mdn_success</tt>、
<tt>mdn_buffer_overflow</tt>、
<tt>mdn_invalid_encoding</tt>、
<tt>mdn_nomemory</tt>
のいずれかです。
<p>One of the following values is returned:
<br><tt>mdn_success</tt>
<br><tt>mdn_buffer_overflow</tt>
<br><tt>mdn_invalid_encoding</tt>
<br><tt>mdn_nomemory</tt>

</dl>

<hr>

<h3><a name="res">res モジュール <br>
res module</a></h3>

<p>res モジュールはクライアント側 (リゾルバライブラリやアプリケーション)
で多言語ドメイン名の処理、つまりドメイン名のエンコーディング変換や
正規化を行う際の高レベル API を提供します。
このモジュールはあとで説明する <a href="#resconf">resconf モジュール</a>
とともに用いることを前提に設計されています。<br>
The res module provides high level APIs used when multilingual domain names are processed at the client side (by the resolver library or an application) i.e. when domain name encoding conversion or normalization is performed. This module is designed on the assumption that it will be used together with <a href="#resconf">resconf module</a>, which is explained below.

<p>これらのモジュールの提供する API を使用すれば、
<a href="#converter">converter モジュール</a>や
<a href="#normalizer">normalizer モジュール</a>などの関数を直接
呼び出す必要はありません。<br>
Using APIs provided by the module, it is not necessary to directly call <a href="#converter">converter module</a> or <a href="#normalizer">normalizer module</a> function.

<p>以下にモジュールの提供するAPI関数を示します。<br>
This module provides the following API functions.

<dl>
<dt><a name="mdn_res_localtoucs">mdn_res_localtoucs</a>
<dd>
<pre>
mdn_result_t
mdn_res_localtoucs(mdn_resconf_t conf, const char *local_name,
	char *ucs_name, size_t ucs_name_len)
</pre>
<p>アプリケーションの使用するローカルエンコーディングで表された
ドメイン名文字列 <var>local_name</var> を UTF-8 に変換し、その結果を
<var>ucs_name</var> に格納します。<var>ucs_name_len</var> で
あらかじめ <var>ucs_name</var> に確保した領域の大きさを指定します。<br>
Converts <var>local_name</var> domain name character strings expressed in the local encoding used by the application to UTF-8 and stores the result in <var>ucs_name</var>. <var>ucs_name_len</var> is used to specify the size of the area secured for <var>ucs_name</var> beforehand.

<p><var>conf</var> は <a href="#resconf">resconf モジュール</a> の返す
クライアント設定コンテキストです。もし <var>conf</var> が NULL であれば
変換は行われず、<var>local_name</var> の内容がそのまま <var>ucs_name</var>
にコピーされます。<br>
<var>conf</var> is the client configuration context returned by <a href="#resconf">resconf module</a>. When <var>conf</var> is NULL, conversion is not performed and the contents of <var>local_name</var> is copied to <var>ucs_name</var> as is.

<p>ドメイン名 <var>local_name</var> が従来の ASCII ドメイン名として
正しく (つまり英数字およびハイフンとピリオドから構成される)、かつ
クライアント設定コンテキスト <var>conf</var> に代替エンコーディング
が設定されている場合、ローカルエンコーディングとしての変換を行う前に
代替エンコーディングから UTF-8 の変換を試み、失敗した場合に
ローカルエンコーディングから UTF-8 への変換を行います。これによって、
<a href="#mdn_res_ucstolocal"><em>mdn_res_ucstolocal</em></a> が
与えられたドメイン名をローカルエンコーディングに変換できず
代替エンコーディングに変換した場合でも、それを本関数に与えれば
正しい UTF-8 エンコーディングのドメイン名が得られます。<br>
Conversion from local encoding to UTF-8 is performed when the <var>local_name</var> domain name is a valid conventional ASCII domain name (that is, it consists of alphanumeric characters, hyphens and periods), alternate encoding is set in the client configuraiton context <var>conf</var>, and conversion to UTF-8 from the alternate encoding is attempted and failed before conversion of the local encoding is performed. Because of this, even if <a href="#mdn_res_ucstolocal"><em>mdn_res_ucstolocal</em></a> could not convert the given domain name to the local encoding and converted to the alternate encoding, if it is given to this function, the correct UTF-8 encoded domain name can be obtained.

<p>返される値は
<tt>mdn_success</tt>、
<tt>mdn_buffer_overflow</tt>、
<tt>mdn_invalid_name</tt>、
<tt>mdn_failure</tt>
のいずれかです。
<p>One of the following values is returned:
<br><tt>mdn_success</tt>
<br><tt>mdn_buffer_overflow</tt>
<br><tt>mdn_invalid_name</tt>
<br><tt>mdn_failure</tt>

<p>

<dt><a name="mdn_res_ucstolocal">mdn_res_ucstolocal</a>
<dd>
<pre>
mdn_result_t
mdn_res_ucstolocal(mdn_resconf_t conf, const char *ucs_name,
	char *local_name, size_t local_name_len)
</pre>
<p><a href="#mdn_res_localtoucs"><em>mdn_res_localtoucs</em></a> の
逆の変換、つまり UTF-8 で表されたドメイン名文字列 <var>ucs_name</var>
をアプリケーションの使用するローカルエンコーディングに変換し、その結果を
<var>local_name</var> に格納します。<var>local_name_len</var> で
あらかじめ <var>local_name</var> に確保した領域の大きさを指定します。<br>
Performs reverse conversion of <a href="#mdn_res_localtoucs"><em>mdn_res_localtoucs</em></a>, i.e., converts the <var>ucs_name</var> domain name character string expressed in UTF-8 to the local encoding used by the application and stores the result in <var>local_name</var>. <var>local_name_len</var> is used to specify the size of the area secured for <var>local_name</var> beforehand.

<p><var>conf</var> は <a href="#resconf">resconf モジュール</a> の返す
クライアント設定コンテキストです。もし <var>conf</var> が NULL であれば
変換は行われず、<var>local_name</var> の内容がそのまま <var>ucs_name</var>
にコピーされます。<br>
<var>conf</var> is the client configuration context returned by <a href="#resconf">resconf module</a>. When <var>conf</var> is NULL, conversion is not performed and the contents of <var>local_name</var> is copied in <var>ucs_name</var> as is.

<p>もしドメイン名 <var>ucs_name</var> の中にローカルエンコーディングの
文字集合にない文字があって変換に失敗した場合、クライアント設定コンテキスト
<var>conf</var> に代替エンコーディングが設定されていれば、
ローカルエンコーディングの代わりに代替エンコーディングへの変換が行われます。
これにより、たとえ DNS サーバからローカルエンコーディングに含まれない文字を
含むドメイン名が返された場合にもエラーとならずに変換が行われます。
なお、代替エンコーディングに変換された文字列は
<a href="#mdn_res_localtoucs"><em>mdn_res_localtoucs</em></a> によって
UTF-8 文字列に戻すことが可能です。<br>
When conversion fails because a character that is not in the character set of the local encoding is contained in the <var>ucs_name</var> domain name, if the alternate encoding is set in the client configuration context <var>conf</var>, conversion to the alternate encoding is performed instead of to the local encoding.
Because of this, even if the DNS server returns a domain name that includes a character that is not included in the local encoding, conversion is performed without error. Note that character strings converted to the alternate encoding can be returned to UTF-8 character strings by <a href="#mdn_res_localtoucs"><em>mdn_res_localtoucs</em></a>.

<p>返される値は
<tt>mdn_success</tt>、
<tt>mdn_buffer_overflow</tt>、
<tt>mdn_invalid_name</tt>、
<tt>mdn_failure</tt>
のいずれかです。
<p>One of the following values is returned:
<br><tt>mdn_success</tt>
<br><tt>mdn_buffer_overflow</tt>
<br><tt>mdn_invalid_name</tt>
<br><tt>mdn_failure</tt>

<p>

<dt><a name="mdn_res_normalize">mdn_res_normalize</a>
<dd>
<pre>
mdn_result_t
mdn_res_normalize(mdn_resconf_t conf, const char *name,
                  char *normalized_name, size_t normalized_name_len)
</pre>
<p>クライアント設定コンテキスト <var>conf</var> にしたがって
UTF-8 で表されたドメイン名 <var>name</var> に対して正規化を実行し、
その結果を <var>normalized_name</var> に格納します。
<var>normalized_name_len</var> であらかじめ <var>normalized_name</var> に
確保した領域の大きさを指定します。<br>
Executes normalization on the <var>name</var> domain name expressed in UTF-8 according to the client configuration context <var>conf</var> and stores the result in <var>normalized_name</var>.
<var>normalized_name_len</var> is used to specify the size of the area secured for <var>normalized_name</var> beforehand.

<p>もし <var>conf</var> が NULL であれば正規化は行われず、
<var>name</var> の内容がそのまま <var>normalized_name</var> にコピーされます。<br>
When <var>conf</var> is NULL, normalization is not performed and the contents of <var>name</var> is copied in <var>normalized_name</var> as is.

<p>返される値は
<tt>mdn_success</tt>、
<tt>mdn_buffer_overflow</tt>、
<tt>mdn_invalid_encoding</tt>、
<tt>mdn_nomemory</tt>
のいずれかです。
<p>One of the following values is returned:
<br><tt>mdn_success</tt>
<br><tt>mdn_buffer_overflow</tt>
<br><tt>mdn_invalid_encoding</tt>
<br><tt>mdn_nomemory</tt>

<p>

<dt><a name="mdn_res_ucstodns">mdn_res_ucstodns</a>
<dd>
<pre>
mdn_result_t
mdn_res_ucstodns(mdn_resconf_t conf, const char *ucs_name, char *dns_name,
	size_t dns_name_len)
</pre>
<p>クライアント設定コンテキスト <var>conf</var> にしたがって
UTF-8 で表されたドメイン名 <var>ucs_name</var> を DNS プロトコル上で
用いられるエンコーディングに変換し、その結果を <var>dns_name</var> に
格納します。
<var>dns_name_len</var> であらかじめ <var>dns_name_len</var> に
確保した領域の大きさを指定します。<br>
Converts the <var>ucs_name</var> domain name expressed in UTF-8 to the encoding used in the DNS protocol per the <var>conf</var> client configuration context and stores the result in <var>dns_name</var>. <var>dns_name_len</var> is used to specify the size of the area secured for <var>dns_name_len</var> beforehand.

<p>もし <var>conf</var> が NULL であれば変換は行われず、
<var>ucs_name</var> の内容がそのまま <var>dns_name</var> にコピーされます。<br>
When <var>conf</var> is NULL, conversion is not performed and the contents of <var>ucs_name</var> are copied to <var>dns_name</var> as is.

<p>返される値は
<tt>mdn_success</tt>、
<tt>mdn_buffer_overflow</tt>、
<tt>mdn_invalid_encoding</tt>、
<tt>mdn_invalid_name</tt>、
<tt>mdn_failure</tt>
のいずれかです。
<p>One of the following values is returned:
<br><tt>mdn_success</tt>
<br><tt>mdn_buffer_overflow</tt>
<br><tt>mdn_invalid_encoding</tt>
<br><tt>mdn_invalid_name</tt>
<br><tt>mdn_failure</tt>

<p>

<dt><a name="mdn_res_dnstoucs">mdn_res_dnstoucs</a>
<dd>
<pre>
mdn_result_t
mdn_res_dnstoucs(mdn_resconf_t conf, const char *dns_name, char *ucs_name,
	size_t ucs_name_len)
</pre>
<p><a href="#mdn_res_ucstodns"><em>mdn_res_ucstodns</em></a> の逆変換、
つまりクライアント設定コンテキスト <var>conf</var> にしたがって
DNS プロトコル上のエンコーディングで表されたドメイン名 <var>dns_name</var>
を UTF-8 に変換し、その結果を <var>ucs_name</var> に格納します。
<var>ucs_name_len</var> であらかじめ <var>ucs_name_len</var> に
確保した領域の大きさを指定します。<br>
Performs reverse conversion of <a href="#mdn_res_ucstodns"><em>mdn_res_ucstodns</em></a>, i.e., converts the <var>dns_name</var> domain name expressed in the encoding used in the DNS protocol to UTF-8 per the <var>conf</var> client configuration context and stores the result in <var>ucs_name</var>. <var>ucs_name_len</var> is used to specify the size of the area secured for <var>ucs_name_len</var> beforehand.

<p>もし <var>conf</var> が NULL であれば変換は行われず、
<var>dns_name</var> の内容がそのまま <var>ucs_name</var> にコピーされます。<br>
When <var>conf</var> is NULL, conversion is not peformed and the contents of <var>dns_name</var> are copied to <var>ucs_name</var> as is.

<p>返される値は
<tt>mdn_success</tt>、
<tt>mdn_buffer_overflow</tt>、
<tt>mdn_invalid_encoding</tt>、
<tt>mdn_invalid_name</tt>、
<tt>mdn_failure</tt>
のいずれかです。
<p>One of the following values is returned:
<br><tt>mdn_success</tt>
<br><tt>mdn_buffer_overflow</tt>
<br><tt>mdn_invalid_encoding</tt>
<br><tt>mdn_invalid_name</tt>
<br><tt>mdn_failure</tt>

</dl>

<hr>

<h3><a name="resconf">resconf モジュール <br>
resconf module</a></h3>

<p>resconf モジュールはクライアント側 (リゾルバライブラリやアプリケーション)
で多言語ドメイン名の処理を行う際に参照される
<a href="clientconfig.html">クライアント設定ファイル</a>を読み込み、
ファイルに記述された設定にしたがった初期化を実行します。また
設定情報を取り出す機能を提供します。<br>
The resconf module loads the <a href="clientconfig.html"> client configuration file</a> referenced when a multilingual domain name is processed at the client side (by a resolver library or application) and executes initialization in accordance with the settings described in the file. It also provides a function to extract the setting information.

<p>resconf モジュールは「クライアント設定コンテキスト」という概念を用います。
クライアント設定ファイルに記述された設定はこのクライアント設定コンテキストに
格納され、このコンテキストを引数にして API 関数を呼び出すことによって
設定された値を取り出すことができます。
クライアント設定コンテキストの型は <em>mdn_resconf_t</em> 型であり、
次のような opaque 型として定義されています。<br>
The resconf module uses the "client configuration context" concept.
Settings described in the client configuration file are stored in this client configuration context, which is used as an argument to call API functions to extract the set values. The client configuration context is defined by <em>mdn_resconf_t</em> and is of the following opaque type.
<blockquote>
<pre>
typedef struct mdn_resconf *mdn_resconf_t;
</pre>
</blockquote>

</pre>
</blockquote>
<p>このモジュールは単体でも使用できますが、
<a href="#res">res モジュール</a>と組み合わせることによって、
クライアント側での多言語ドメイン名の処理を簡単に行うことができるように
設計されています。<br>
This module can be used as a single module but it is designed so that by combining it with <a href="#res">res module</a> multilingual domain names can easily be processed at the client side.

<p>以下にモジュールの提供するAPI関数を示します。<br>
This module provides the following API functions.

<dl>

<dt><a name="mdn_resconf_initialize">mdn_resconf_initialize</a>
<dd>
<pre>
mdn_result_t
mdn_resconf_initialize(void)
</pre>
<p>多言語ドメイン名の処理を行う際に必要な初期化を実行します。
本モジュールの他のAPI関数を呼ぶ前に必ず呼び出してください。
本モジュールが使用する他のモジュールの初期化もすべて行うので、これ以外の初期化
関数を呼び出す必要はありません。<br>
Executes initialization required when processing multilingual domain names. Always call this function before calling other API functions of this module. Since this function initializes all other modules used by this module, it is not necessary to call another initialization function.
<p>返される値は
<tt>mdn_success</tt>、
<tt>mdn_nomemory</tt>
のいずれかです。
<p>One of the following values is returned:
<br><tt>mdn_success</tt>
<br><tt>mdn_nomemory</tt>
<p>

<dt><a name="mdn_resconf_create">mdn_resconf_create</a>
<dd>
<pre>
mdn_result_t
mdn_resconf_create(mdn_resconf_t *ctxp)
</pre>
<p>クライアント設定コンテキストを作成、初期化し、<var>ctxp</var> の指す
領域に格納します。
初期状態では、まだクライアント設定ファイルの内容は読み込まれていません。
読み込むためには <a href="#mdn_resconf_loadfile">
<em>mdn_resconf_loadfile</em></a> を実行する必要があります。<br>
Creates and initializes client configuration context and stores it in the area indicated by <var>ctxp</var>. In the initial status, the contents of the client configuration file are not loaded. To do so, <a href="#mdn_resconf_loadfile"> <em>mdn_resconf_loadfile</em></a> must be executed.
<p>返される値は
<tt>mdn_success</tt>、
<tt>mdn_nomemory</tt>
のいずれかです。
<p>One of the following values is returned:
<br><tt>mdn_success</tt>
<br><tt>mdn_nomemory</tt>
<p>

<dt><a name="mdn_resconf_destroy">mdn_resconf_destroy</a>
<dd>
<pre>
void
mdn_resconf_destroy(mdn_resconf_t ctx)
</pre>
<p><a href="mdn_resconf_create"><em>mdn_resconf_create</em></a> で
作成されたクライアント設定コンテキストを削除し、確保したメモリを解放します。<br>Deletes the client configuration context created by <a href="mdn_resconf_create"><em>mdn_resconf_create</em></a> and releases the allocated memory.
<p>

<dt><a name="mdn_resconf_loadfile">mdn_resconf_loadfile</a>
<dd>
<pre>
mdn_result_t
mdn_resconf_loadfile(mdn_resconf_t ctx, const char *file)
</pre>
<p><var>file</var> で指定される
<a href="clientconfig.html">クライアント設定ファイル</a>の内容を読み込み、
設定内容をクライアント設定コンテキスト <var>ctx</var> に格納します。
<var>file</var> が NULL の場合にはデフォルトのクライアント設定ファイルの
内容を読み込みます。<br>
Loads the contents of the <a href="clientconfig.html">client configuration file</a> specified by <var>file</var> and stores the setting contents in the <var>ctx</var> client configuration context.
When <var>file</var> is NULL, the contents of the default client configuration file are loaded.
<p>すでに設定ファイルが読み込まれているコンテキストに対して、
別の設定ファイルの内容を読み込むこともできます。その場合には、
クライアント設定コンテキストに格納されていた前の設定ファイルの内容は
すべて消え、新たに読み込んだ設定ファイルの内容で置き換わります。<br>
If the configuration file has already been loaded and another configuration file is loaded, the previous configuration file contents stored in the client configuration context are erased and replaced with the newly loaded configuration file contents.
<p>返される値は
<tt>mdn_success</tt>、
<tt>mdn_nofile</tt>、
<tt>mdn_invalid_syntax</tt>、
<tt>mdn_invalid_name</tt>、
<tt>mdn_nomemory</tt>
のいずれかです。
<p>One of the following values is returned:
<br><tt>mdn_success</tt>
<br><tt>mdn_nofile</tt>
<br><tt>mdn_invalid_syntax</tt>
<br><tt>mdn_invalid_name</tt>
<br><tt>mdn_nomemory</tt>
<p>

<dt><a name="mdn_resconf_defaultfile">mdn_resconf_defaultfile</a>
<dd>
<pre>
char *
mdn_resconf_defaultfile(void)
</pre>
<p>デフォルトのクライアント設定ファイルのパス名を返します。
これは mDNkit のコンパイル時の設定によって決まりますが、特に指定しなければ <br>
Returns the path to the default client configuration file. This is determined by the settings set when mDNkit is compiled. The default path is as follows:
<blockquote>
<pre>
/usr/local/etc/mdnres.conf
</pre>
</blockquote>
です。
<p>

<dt><a name="mdn_resconf_localconverter">mdn_resconf_localconverter</a>
<dd>
<pre>
mdn_converter_t
mdn_resconf_localconverter(mdn_resconf_t ctx)
</pre>
<p>クライアント設定コンテキスト <var>ctx</var> の情報を元に、
ローカルエンコーディングと UTF-8 との間の文字コード変換を行うための
コード変換コンテキストを返します。ローカルエンコーディングが判別できなかった
場合には NULL を返します。<br>
Based on the <var>ctx</var> client configuration context information, returns the code conversion context to perform character code conversion between the local encoding and UTF-8. NULL is returned if the local encoding cannot be determined.
<p>コード変換コンテキストについては
<a href="#converter">converter モジュール</a> の項をご覧ください。<br>
For details of code conversion context, refer to the <a href="#converter">converter module</a> section.
<p>

<dt><a name="mdn_resconf_alternateconverter">mdn_resconf_alternateconverter</a>
<dd>
<pre>
mdn_converter_t
mdn_resconf_alternateconverter(mdn_resconf_t ctx)
</pre>
<p>クライアント設定コンテキスト <var>ctx</var> の情報を元に、
代替エンコーディングと UTF-8 との間の
文字コード変換を行うためのコード変換コンテキストを返します。
代替エンコーディングとはドメイン名をローカルエンコーディングに変換することが
できなかった場合に、ローカルエンコーディングの代わりに用いられる
エンコーディングのことです。
クライアント設定ファイルがまだ読み込まれていなかったり、設定ファイルに
エンコーディングの指定がなかった場合には NULL を返します。<br>
Based on the <var>ctx</var> client configuration context information, returns the code conversion context to perform character code conversion between the alternate encoding and UTF-8. The alternate encoding is used instead of the local encoding when a domain name could not be converted to the local encoding. NULL is returned if the client configuration file has not been loaded or the encoding method is not specified in the configuration file.
<p>コード変換コンテキストについては
<a href="#converter">converter モジュール</a> の項をご覧ください。<br>
For code conversion context, refer to <a href="#converter">converter module</a> section.
<p>

<dt><a name="mdn_resconf_serverconverter">mdn_resconf_serverconverter</a>
<dd>
<pre>
mdn_converter_t
mdn_resconf_serverconverter(mdn_resconf_t ctx)
</pre>
<p>クライアント設定コンテキスト <var>ctx</var> の情報を元に、
DNS プロトコル上で用いられるエンコーディングと UTF-8 との間の
文字コード変換を行うためのコード変換コンテキストを返します。
クライアント設定ファイルがまだ読み込まれていなかったり、設定ファイルに
エンコーディングの指定がなかった場合には NULL を返します。<br>
Based on the information of client configuration context ctx, returns the code conversion context to perform character code conversion between the encoding used on DNS protocol and UTF-8. NULL is returned if the client configuration file has not been loaded or the encoding method is not specified in the configuration file.

<p>コード変換コンテキストについては
<a href="#converter">converter モジュール</a> の項をご覧ください。<br>
For code conversion context, refer to <a href="#converter">converter module</a>  section. 
<p>

<dt><a name="mdn_resconf_ZLD">mdn_resconf_ZLD</a>
<dd>
<pre>
const char *
mdn_resconf_ZLD(mdn_resconf_t ctx)
</pre>
<p>クライアント設定コンテキスト <var>ctx</var> の情報を元に、
多言語ドメイン名と従来のドメイン名とを区別するために一部の
エンコーディングとともに用いられる ZLD の文字列を返します。
ZLD を使用しない設定の場合には NULL を返します。<br>
Based on the information in the <var>ctx</var> client configuration context, returns the ZLD character string used together with some encoding methods to differentiate between multilingual domain names and conventional domain names. NULL is returned when ZLD is not used.
<p>mDNkit はデフォルトの設定では ZLD をサポートせず、この関数は常に
NULL を返します。mDNkit を ZLD をサポートするように設定する方法に
ついては mDNkit のインストールガイドの
<a href="../guide/install.html#configure"><tt>configure</tt> 実行</a>
の項をご覧ください。<br>
By default, mDNkit does not support ZLD and this function always returns NULL. For details of how to set mKNkit to support ZLD, refer to <a href="../guide/install.html#configure"><tt>configure</tt> execute</a> in the mDNkit Installation Guide.
<p>

<dt><a name="mdn_resconf_normalizer">mdn_resconf_normalizer</a>
<dd>
<pre>
mdn_normalizer_t
mdn_resconf_normalizer(mdn_resconf_t ctx)
</pre>
<p>クライアント設定コンテキスト <var>ctx</var> の情報を元に、
ドメイン名を正規化するための正規化コンテキストを返します。
クライアント設定ファイルがまだ読み込まれていなかったり、設定ファイルに
正規化方式の指定がなかった場合には NULL を返します。<br>
Based on the information of client configuration context ctx, returns the normalization context used to normalize domain names.
NULL is returned if the client configuration file has not been loaded or the normalization method is not specified in the configuration file.
<p>正規化コンテキストについては
<a href="#normalizer">normalizer モジュール</a> の項をご覧ください。<br>
For details of normalization context, refer to the <a href="#normalizer">normalizer module</a> section.

</dl>

<hr>

<h3><a name="result">result モジュール result module</a></h3>

<p>result モジュールはライブラリの各関数が返す
<a href="#mdn_result_t"><tt>mdn_result_t</tt>型の値</a>を扱うモジュールで、
値からそのコードに対応するメッセージへの変換を提供します。<br>
The result module handles the <a href="#mdn_result_t"><tt>mdn_result_t</tt> type value</a> returned by each function in the library and converts the value to the corresponding message code.

<p>以下にモジュールの提供するAPI関数を示します。<br>
This module provides the following API functions.

<dl>

<dt>
<dd>
<pre>
char *
mdn_result_tostring(mdn_result_t result)
</pre>
<p><tt>mdn_result_t</tt>型の値 <var>result</var> に対応する
メッセージ文字列を返します。<br>
Returns the message character string corresponding to the value <var>result</var> of <tt>mdn_result_t</tt> type.
<p>未定義のコードに対しては <tt>unknown result code</tt> という文字列が
返されます。<br>
An <tt>unknown result code</tt> character string is returned for undefined code.

</dl>

<hr>

<h3><a name="selectiveencode">selectiveencode モジュール selectiveencode module</a></h3>

<p>selectiveencode モジュールはゾーンマスタファイル等のテキストの中から
非ASCII文字を含むドメイン名を探し出すモジュールです。
もちろんテキストのどの部分がドメイン名なのかを判定することは一般的には
不可能なので、実際には次のような大きな仮定を置くことによって
近似的に実現しています。<br>
The selectiveencode module finds domain names that include non-ASCII characters in text such as zone master files. Generally speaking it is of course impossible to determine which part of the text is the domain name; in actuality, however, the following rough assumptions are used to approximately implement it.
<ul>
<li>非ASCII文字はドメイン名の中にのみ現れる <br>
Non-ASCII characters appear only in domain names.
</ul>
<p>具体的には次のようなアルゴリズムを用いてドメイン名の領域検出を行います。<br>
Specifically, the following algorithm is used to detect the domain name area.
<ol>
<li>テキストを走査して、非ASCII文字を探す。<br>
Scans the text and finds non-ASCII characters.
<li>見つかった非ASCII文字の前後の文字を調べ、
    その文字を含み、かつ他の非ASCII文字あるいは従来の(多言語化されていない)
    ドメイン名として使用可能な文字だけからなる範囲を求める。<br>
Check characters before and after found non-ASCII characters to determine a range consisting of only the found character and also other non-ASCII characters or characters that can be used for conventional (not internationalized) domain names. 
<li>求めた範囲をドメイン名として返す。<br>
Returns the found range as the domain name.
</ol>

<p>以下にモジュールの提供するAPI関数を示します。<br>
This module provides the following API functions.

<dl>

<dt><a name="mdn_selectiveencode_findregion">mdn_selectiveencode_findregion</a>
<dd>
<pre>
mdn_result_t
mdn_selectiveencode_findregion(const char *s,
	char **startp, char **endp)
</pre>
<p>UTF-8でエンコードされた文字列 <var>s</var> を走査して、最初に出現する
非ASCII文字を含むドメイン名の領域を求め、その先頭を指すポインタを
<var>startp</var> に、領域の直後の文字を指すポインタを <var>endp</var> に
それぞれ格納します。<br>
Scans <var>s</var> UTF-8 encoded character strings and finds the area in the domain that includes the first appearance of a non-ASCII character, then stores a pointer indicating the beginning of the area at <var>startp</var> and a pointer indicating the end of the area in <var>endp</var>.
<p>返される値は
<tt>mdn_success</tt>、
<tt>mdn_notfound</tt>
のいずれかです。
<p>One of the following values is returned:
<br><tt>mdn_success</tt>
<br><tt>mdn_notfound</tt>

</dl>

<hr>

<h3><a name="strhash">strhash モジュール <br>
strhash module</a></h3>

<p>strhash モジュールは文字列をキーとするハッシュ表を実現するモジュールです。
ハッシュ表は
<a href="converter">converter モジュール</a>や
<a href="normalizer">normalizer モジュール</a>などライブラリの他のモジュールで
使用されます。
非常に一般的なハッシュ表の実装であり、特筆すべき点はありません…
一つだけあります。登録はできますが削除の機能がありません。本ライブラリでは
必要ないからです。<br>
The strhash module implements a hash table that uses a character string as a key. The hash table is used by other modules in the library such as the <a href="converter">converter module</a> and <a href="normalizer">normalizer module</a>. This is a very general hash table implementation in which registration can be performed but there is no deletion function because it is not needed with this library.

<p>ハッシュ表のサイズは要素の総数が増えるに従って大きくなります。<br>
The size of the hash table increases as the total numer of elements increases.

<p>ハッシュ表は次に示す <em>mdn_strhash_t</em> 型の opaque データとして
表されます。<br>
As shown below, the hash table is expressed in opaque data of <em>mdn_strhash_t</em> type.
<blockquote>
<pre>
typedef struct mdn_strhash *mdn_strhash_t;
</pre>
</blockquote>

<p>以下にモジュールの提供するAPI関数を示します。<br>
This module provides the following API functions.

<dl>

<dt><a name="mdn_strhash_create">mdn_strhash_create</a>
<dd>
<pre>
mdn_result_t
mdn_strhash_create(mdn_strhash_t *hashp)
</pre>
<p>空のハッシュ表を作成し、そのハンドルを <var>hashp</var> の指す領域に
格納します。<br>
Creates an empty hash table and stores the handle to the area indicated by <var>hashp</var>. 
<p>返される値は
<tt>mdn_success</tt>、
<tt>mdn_nomemory</tt>
のいずれかです。
<p>One of the following values is returned:
<br><tt>mdn_success</tt>
<br><tt>mdn_nomemory</tt>
<p>

<dt><a name="mdn_strhash_destroy">mdn_strhash_destroy</a>
<dd>
<pre>
void
mdn_strhash_destroy(mdn_strhash_t hash)
</pre>
<p><a href="#mdn_strhash_create"><em>mdn_strhash_create</em></a> で作成した
ハッシュ表を削除し、確保したメモリを解放します。<br>
Deletes the hash table created by <a href="#mdn_strhash_create"><em>mdn_strhash_create</em></a> and releases the allocated memory.
<p>

<dt><a name="mdn_strhash_put">mdn_strhash_put</a>
<dd>
<pre>
mdn_result_t
mdn_strhash_put(mdn_strhash_t hash, const char *key,
	void *value)
</pre>
<p><a href="#mdn_strhash_create"><em>mdn_strhash_create</em></a> で作成した
ハッシュ表 <var>hash</var> にキー <var>key</var>、値 <var>value</var> の組を
登録します。
文字列 <var>key</var> はコピーされますので、この関数の呼び出し後
<var>key</var> の指すメモリを解放しても、文字列の内容を書き換えても
影響はありません。これに対して <var>value</var> の内容はコピーされないので
注意してください (もちろんよく考えてみればコピーされないことは自明ですが)。<br>
Used to register a <var>key</var> and <var>value</var> set in the hash table created by <a href="#mdn_strhash_create"><em>mdn_strhash_create</em></a>.
Since character strings are copied, there is no influence even if the memory indicated by <var>key</var> is released or the contents of the character strings are changed after this function is called. Contrarily, the contents of <var>value</var> are not copied, so use care when working with this item. (If you think carefully about it, it will become obvious that this value is not copied.)
<p>同じキーを使用して複数回登録した場合、最後に登録されたものだけが
有効です。<br>
When the same key is used for registration more than once, only the most recently registered key is effective.
<p>返される値は
<tt>mdn_success</tt>、
<tt>mdn_nomemory</tt>
のいずれかです。
<p>One of the following values is returned:
<br><tt>mdn_success</tt>
<br><tt>mdn_nomemory</tt>
<p>

<dt><a name="mdn_strhash_get">mdn_strhash_get</a>
<dd>
<pre>
mdn_result_t
mdn_strhash_get(mdn_strhash_t hash,
	const char *key, void **valuep)
</pre>
<p>ハッシュ表 <var>hash</var> からキー <var>key</var> を持つ要素を検索し、
対応する要素があればその値を <var>valuep</var> に格納します。<br>
Searches for elements that have <var>key</var> in the <var>hash</var> table; if a corresponding element is found, the value is stored in <var>valuep</var>.
<p>返される値は
<tt>mdn_success</tt>、
<tt>mdn_noentry</tt>
のいずれかです。
<p>One of the following values is returned:
<br><tt>mdn_success</tt>
<br><tt>mdn_noentry</tt>
<p>

<dt><a name="mdn_strhash_exists">mdn_strhash_exists</a>
<dd>
<pre>
int
mdn_strhash_exists(mdn_strhash_t hash, const char *key)
</pre>
<p>ハッシュ表 <var>hash</var> にキー <var>key</var> を持つ要素があれば
1を、なければ 0 を返します。<br>
Returns 1 if there is an element that has the <var>key</var> in the <var>hash</var> table, and returns 0 if no element is found.

</dl>

<hr>

<h3><a name="translator">translator モジュール <br>
translator module</a></h3>

<p>translator モジュールは、与えられたパラメータに従ってドメイン名を
変換するモジュールです。パラメータとしては次にあげるデータを与えます。<br>
The translator module converts domain names in accordance with the given parameters. Values can provided for the following parameters.
<ul>
<li>入力として渡すドメイン名のエンコーディング (ローカルエンコーディング)<br>
Encoding (local encoding) of domain name passed as input
<li>入力として渡すドメイン名の代替エンコーディング
    (ローカル代替エンコーディング)<br>
Alternate encoding of domain name passed as input (local alternate encoding)
<li>入力として渡すドメイン名のZLD (ローカル ZLD)<br>
ZLD (local ZLD) of domain name passed as input
<li>正規化方式
Normalization method
<li>ドメイン名の変換後のエンコーディング (ターゲットエンコーディング)<br>
Encoding after conversion of domain name (target encoding)
<li>ターゲットエンコーディングへの変換が失敗した時に用いるエンコーディング
    (ターゲット代替エンコーディング)<br>
Encoding used when conversion to target encoding failed (target alternate encoding)
<li>ドメイン名の変換後のZLD (ターゲットZLD)<br>
ZLD after conversion of domain name (target ZLD)
</ul>

<p>ドメイン名の変換の手続きはやや複雑です。これは次の理由によります。<br>
The domain name conversion procedure is complicated, for the following reasons:
<ul>
<li>ドメイン名として常に多言語ドメイン名が渡されるわけではなく、
    従来のASCIIドメイン名も渡される可能性があり、
    そのどちらであるかによって処理を変える必要があること <br>
Multilingual domain names are not always passed as the domain name, and it is possible that conventional ASCII domain names may be passed and processing thus must be changed accordingly.
<li>またこの2つを判別する処理がASCII互換エンコーディングの場合
    簡単ではなく、ZLD等を参照する必要があること <br>
With regard to ASCII-compatible encoding, differentiating between multilingual domain names and conventional ASCII domain names is not simple and ZLD, etc. need to be referenced.
<li>さらにローカル代替エンコーディングでエンコードされたドメイン名も
    渡される可能性があること <br>
Domain names may be passed that are encoded using local alternate encoding.
<li>さらにターゲットエンコーディングへの変換が失敗した時には
    代替エンコーディングを代わりに使用する必要があること <br>
If conversion to the target encoding fails, alternate encoding must be used instead.
</ul>

<p>具体的には、次のようなアルゴリズムを使用して変換を行います。<br>
Specifically, the following algorithm is used for conversion.
<ol>
<li>ローカルZLDが定義されている (空でない) かどうかを調べる。<br>
Checks if the local ZLD is defined (empty or not).
<li>定義されていれば、渡されたドメイン名がそれにマッチするかどうか調べる。<br>
If it is defined, checks whether or not the passed domain name matches.
<li>マッチすれば多言語ドメイン名だと判断し、ドメイン名からZLDを除去し、
    6のコード変換処理へと移る。<br>
    マッチしなければ、従来のASCIIドメイン名だとしてそのまま
    コピーし、処理を終了する。<br>
If it matches, the domain name is determined to be a multilingual doman name and ZLD is removed from the domain, then processing proceeds to code conversion processing (Step 6).
<li>ローカルZLDが定義されていなければ、ローカルエンコーディングが
    ASCII互換エンコーディングであるかどうか、また渡されたドメイン名が
    従来のASCIIドメイン名として正しいものであるかどうかを調べる。<br>
When the local ZLD is not defined, checks whether or not the local encoding is ASCII-conpatible and also that the passed domain name is a valid conventional ASCII domain name.
<li>もしASCII互換エンコーディングであるか、あるいは渡されたドメイン名に
    従来のASCIIドメイン名として正しくない文字が混じっていれば
    多言語ドメイン名であるとして6のコード変換処理へと移る。<br>
    それ以外の場合には従来のASCIIドメイン名だとしてそのまま 
    コピーし、処理を終了する。<br>
When ASCII compatible encoding is used or the passed domain name includes an invalid character in a conventional ASCII domain name, the passed domain name is assumed to be a multilingual domain name and the procedure proceeds to code conversion processing (Step 6).<br>
For situations other than the above, the passed domain name is assumed to be a conventional ASCII-domain name and is copied as is, then processing ends.
<li>ローカル代替エンコーディングが定義されていれば、まず
    ローカル代替エンコーディングから UTF-8 へとコード変換を実行する。
    成功すれば8の正規化処理へと移る。<br>
When the local alternate encoding is defined, the code is first converted from the local alternate encoding to UTF-8. If this is successful, processing proceeds to normalization processing (Step 8).
<li>ローカルエンコーディングからUTF-8へとコード変換を実行する。<br>
Executes code conversion from local encoding to UTF-8.
<li>正規化処理を実行する。<br>
Executes normalization processing.
<li>UTF-8からターゲットエンコーディングへとコード変換を実行する。<br>
Executes code conversion from UTF-8 to the target encoding.
<li>もしドメイン名にターゲットエンコーディングの文字集合にない文字があって
    変換に失敗した場合には、代わりに UTF-8 から代替エンコーディングへの
    コード変換を実行する。<br>
If the conversion fails because there is a character in the domain name that is not included in the target character set, code conversion from UTF-8 to the alternate encoding is executed instead.
<li>ターゲットZLDが定義されていればドメイン名に追加する。<br>
When the target ZLD is defined, it is added to the domain name.
</ol>

<p>以上の処理をフローチャートで表したのが次の図です。<br>
The following flow chart explains the above procedure.

<blockquote>
<img src="img/translator.jpg" alt="name translation flowchart">
</blockquote>

<p>本モジュールはエンコーディング変換に
<a href="#converter">converter モジュール</a>を、また正規化に
<a href="#normalizer">normalizer モジュール</a>をそれぞれ使用します。<br>
This module uses the <a href="#converter">converter module </a> for encoding and the <a href="#normalizer">normalizer module </a> for normalization.

<p>以下にモジュールの提供するAPI関数を示します。<br>
This module provides the following API functions.

<dl>

<dt><a name="mdn_translator_translate">mdn_translator_translate</a>
<dd>
<pre>
mdn_result_t
mdn_translator_translate(mdn_converter_t local_converter,
	mdn_converter_t local_alternate_converter,
	const char *local_ZLD,
	mdn_normalizer_t normalizer,
	mdn_converter_t target_converter,
	mdn_converter_t target_alternate_converter,
	const char *target_ZLD,
	const char *from, char *to, size_t tolen)
</pre>
<p>与えられたパラメータにしたがってドメイン名 <var>from</var> を変換し、
結果を <var>to</var> と <var>tolen</var> で指定される領域に格納します。<br>
Converts the domain name produced by <var>from</var> per the specified parameters and stores the result in the area specified by <var>to</var> and <var>tolen</var>.
<p>ローカルエンコーディング、ローカル代替エンコーディング、
ターゲットエンコーディングおよびターゲット代替エンコーディングは
エンコーディングの名称ではなく、
対応する<a href="#converter">converter モジュール</a>の
コード変換コンテキスト <var>local_converter</var>、
<var>alternate_converter</var> および <var>target_converter</var> で
指定します。<br>
Local encoding, local alternate encoding, target encoding and target alternate encoding are not the actual names of types of encoding and are specified by the corresponding code conversion context, which is defined by the following <a href="#converter">converter module</a> variables: <var>local_converter</var>,<var>alternate_converter</var> and <var>target_converter</var>.
<p>ターゲット代替エンコーディング <var>target_alternate_converter</var> は、
<var>target_converter</var> によるターゲットエンコーディングへの変換が、
ドメイン名がターゲットエンコーディングの文字集合にない文字を含んでいるために
失敗した時に、ターゲットエンコーディングの代わりに使用されます。<br>
The <var>target_alternate_converter</var> variable is used instead of the target encoding if conversion to the target encoding by <var>target_converter</var> fails because the domain name contains a character that is not included in the target character set.
<p>正規化は<a href="#normalizer">normalizer モジュール</a>の正規化コンテキスト
<var>normalizer</var> で指定します。<br>
Normalization is specified by normalization context defined by the <var>normalizer</var> variable of the <a href="#normalizer">normalizer module</a>.
<p>ローカルZLDおよびターゲットZLDは
<a href="#mdn_translator_canonicalZLD"><em>mdn_translator_canonicalZLD</em></a>
で標準形式に変換したものでなければなりません。<br>
The local ZLD and target ZLD must have been converted to the standard format by <a href="#mdn_translator_canonicalZLD"><em>mdn_translator_canonicalZLD</em></a>.
<p>返される値は
<tt>mdn_success</tt>、
<tt>mdn_buffer_overflow</tt>、
<tt>mdn_invalid_encoding</tt>、
<tt>mdn_nomemory</tt>
のいずれかです。
<p>One of the following values is returned:
<br><tt>mdn_success</tt>
<br><tt>mdn_buffer_overflow</tt>
<br><tt>mdn_invalid_encoding</tt>
<br><tt>mdn_nomemory</tt>
<p>

<dt><a name="mdn_translator_canonicalZLD">mdn_translator_canonicalZLD</a>
<dd>
<pre>
mdn_result_t
mdn_translator_canonicalZLD(const char *ZLD,
	char **canonicalizedp)
</pre>
<p>ZLD <var>ZLD</var> を標準形式に変換し、そのポインタを
<var>canonicalizedp</var> の指す領域に格納します。
変換された文字列 (<var>*canonicalizedp</var>) の領域は
<em>malloc()</em> されていますので、不要になったら <em>free()</em> で
解放してください。<br>
Converts ZLD <var>ZLD</var> to the standard format and stores a pointer in the area specified by <var>canonicalizedp</var>. Since the area for the converted character string (<var>*canonicalizedp</var>) is secured by <em>malloc()</em>, release it when it is no longer needed.
<p>ここでいう ZLD の標準形式とは次のような形式のものを指します。<br>
The standard format for ZLD mentioned is as follows:
<ul>
<li>空のZLD ("" あるいは ".") の標準形式は NULL <br>
The standard format for empty ZLD ("" or ".") is NULL
<li>先頭がピリオド (.) から始まっていればピリオドを除去 <br>
The period is removed when the beginning is a period (.)
<li>最後がピリオド (.) で終わっていなければピリオドを追加 <br>
A period is added when the ending is not a period (.)
<li>小文字はすべて大文字に変換 <br>
Lowercase characters are all converted to uppercase characters
<ul>
<p>返される値は
<tt>mdn_success</tt>、
<tt>mdn_nomemory</tt>
のいずれかです。
<p>One of the following values is returned:
<br><tt>mdn_success</tt>
<br><tt>mdn_nomemory</tt>
<p>

<dt><a name="mdn_translator_matchZLD">mdn_translator_matchZLD</a>
<dd>
<pre>
int
mdn_translator_matchZLD(const char *domain,
	const char *ZLD)
</pre>
<p>ドメイン名 <var>domain</var> と ZLD <var>ZLD</var> がマッチするかどうか
を調べ、マッチすれば1を、しなければ0を返します。<br>
Checks whether or not the <var>domain</var> variable and ZLD <var>ZLD</var> match, and returns a 1 if they match and a 0 if not.
<p>ZLD は
<a href="#mdn_translator_canonicalZLD"><em>mdn_translator_canonicalZLD</em></a>
で標準形式に変換したものでなければなりません。<br>
The ZLD must have been converted to the standard format by <a href="#mdn_translator_canonicalZLD"><em>mdn_translator_canonicalZLD</em></a>.

</dl>

<hr>

<h3><a name="unicode">unicode モジュール <br>
unicode module</a></h3>

<p>unicode モジュールは、
<a href="ftp://ftp.unicode.org/Public/UNIDATA/UnicodeData.txt"><cite>UnicodeData.txt</cite></a>
に記述されている、Unicode の各種文字属性を取得するモジュールです。なお、
Unicode.txt に記述されているデータの意味、およびファイル形式については
<a href="ftp://ftp.unicode.org/Public/UNIDATA/UnicodeData.html"><cite>UnicodeData File Format</cite></a>をご覧ください。<br>
The unicode module obtains various character properties of Unicode described in <a href="ftp://ftp.unicode.org/Public/UNIDATA/UnicodeData.txt"><cite>UnicodeData.txt</cite></a>. For details of the data described in Unicode.txt and the file format, refer to <a href="ftp://ftp.unicode.org/Public/UNIDATA/UnicodeData.html"><cite>UnicodeData File Format</cite></a>.

<p>本ライブラリの多くのモジュールは Unicode のデータを UTF-8エンコードされた
文字列形式で扱いますが、このモジュールは <em>unsigned long</em> 型の
データとして扱います。含まれる値は UCS-4 です。<br>
Many modules in this library handle Unicode data as UTF-8 encoded character strings but this module handles Unicode data as <em>unsigned long</em> type data. Includes UCS-4 values.

<p><a name="mdn__unicode_context_t">
このモジュールでは Unicode 文字の大文字小文字の相互変換機能も
提供しています。</a> これは
<a href="http://www.unicode.org/unicode/reports/tr21">
<cite>Unicode Technical Report #21: Case Mappings</cite></a> で
定義されているものです。
Unicode 文字の中にはごく一部ですが大文字小文字の変換をする際に
文脈情報を必要とするものがあり、これは次のような列挙型のデータで指定します。<br><a name="mdn__unicode_context_t"> </a>This module provides a mutual conversion function between uppercase and lowercase Unicode characters. This is defined by <a href="http://www.unicode.org/unicode/reports/tr21">
<cite>Unicode Technical Report #21: Case Mappings</cite></a>.
Among Unicode characters, a few characters require context information when uppercase is converted to lowercase. This is specified by the following enumeration type data.
<blockquote>
<pre>
typedef enum {
	mdn__unicode_context_unknown,
	mdn__unicode_context_final,
	mdn__unicode_context_nonfinal
} mdn__unicode_context_t;
</pre>
</blockquote>
文脈が FINAL の場合には <tt>mdn__unicode_context_final</tt> を、また
NON_FINAL の場合には <tt>mdn__unicode_context_nonfinal</tt> を指定します。
<tt>mdn__unicode_context_unknown</tt> は文脈情報がわからない (調べていない)
ことを示します。
文脈情報に関して詳しくは上記文献をご覧ください。<br>
When the context is FINAL, <tt>mdn__unicode_context_final</tt> is specified and when it is NON_FINAL, <tt>mdn__unicode_context_nonfinal</tt> is specified. <tt>mdn__unicode_context_unknown</tt> indicates that the context is unknown (has not yet been checked). For a detailed discussion of context information, refer to the above references.

<p>以下にモジュールの提供するAPI関数を示します。<br>
This module provides the following API functions.

<dl>

<dt><a name="mdn__unicode_canonicalclass">mdn__unicode_canonicalclass</a>
<dd>
<pre>
int
mdn__unicode_canonicalclass(unsigned long c);
</pre>
<p>Unicode 文字 <var>c</var> の <em>Canonical Combining Class</em> を求めます。
Canonical Combining Class が定義されていない文字については 0 を返します。<br>
Obtains <em>Canonical Combining Class</em> for Unicode character <var>c</var>.
0 is returned for characters for which Canonical Combining Class is not defined.
<p>

<dt><a name="mdn__unicode_decompose">mdn__unicode_decompose</a>
<dd>
<pre>
mdn_result_t
mdn__unicode_decompose(int compat,
	unsigned long *v, size_t vlen,
	unsigned long c, int *decomp_lenp)
</pre>
<p>Unicode 文字 <var>c</var> を UnicodeData.txt の<em>Character
Decomposition Mapping</em> にしたがって decompose し、その結果を
<var>v</var> および <var>vlen</var> で指定される領域に書き込みます。
<var>compat</var> の値が真なら <em>Compatibility Decomposition</em> を、
偽なら<em>Canonical Decomposition</em> を行います。<br>decompose は再帰的に行われます。つまりCharacter Decomposition Mappingにしたがって分解した各文字についてさらに decompose 処理が行われます。<br>
<p>Decomposes Unicode characters <var>c</var> in accordance with <em>Character
Decomposition Mapping</em> of UnicodeData.txt and writes the result in the area specified by <var>v</var> and <var>vlen</var>. When the value of <var>compat</var> is true, <em>Compatibility Decomposition</em> is performed and when false, <em>Canonical Decomposition</em> is performed. Decompose is performed recursively, i.e. each character resolved in accordance with Character Decomposition Mapping is further decomposed.

<p>返される値は
<tt>mdn_success</tt>、
<tt>mdn_notfound</tt>、
<tt>mdn_nomemory</tt>
のいずれかです。
<p>One of the following values is returned:
<br><tt>mdn_success</tt>
<br><tt>mdn_notfound</tt>
<br><tt>mdn_nomemory</tt>
<p>

<dt><a name="mdn__unicode_compose">mdn__unicode_compose</a>
<dd>
<pre>
mdn_result_t
mdn__unicode_compose(unsigned long c1,
	unsigned long c2, unsigned long *compp)
</pre>
<p><var>c1</var> と <var>c2</var> の2文字の Unicode 文字のシーケンスを
UnicodeData.txt の<em>Character Decomposition Mapping</em> にしたがって
compose し、その結果を <var>compp</var> の指す領域に書き込みます。
必ず <em>Canonical Composition</em> が行われます。<br>
Composes a sequence of the two Unicode characters <var>c1</var> and <var>c2</var> per the <em>Character Decomposition Mapping</em> in UnicodeData.txt and writes the result in the area specified by <var>compp</var>. <em>Canonical Composition</em> is always peformed.
<p>返される値は
<tt>mdn_success</tt>、
<tt>mdn_notfound</tt>
のいずれかです。
<p>One of the following values is returned:
<br><tt>mdn_success</tt>
<br><tt>mdn_notfound</tt>
<p>

<dt><a name="mdn__unicode_iscompositecandidate">mdn__unicode_iscompositecandidate</a>
<dd>
<pre>
int
mdn__unicode_iscompositecandidate(unsigned long c)
</pre>
<p>Unicode文字 <var>c</var> から始まる Canonical Composition が存在するか
どうかを調べ、存在する可能性があれば 1 を可能性がなければ 0 を返します。
これはヒント情報であり、1が返ってきたとしても実際には Composition が
存在しないこともあり得ます。逆に 0 が返ってくれば確実に存在しません。<br>
Checks whether or not Canonical Composition that begins with Unicode character <var>c</var> exists. 1 is returned if existence is possible, and 0 if not. If 1 is returned, it is possible that Composition does not actually exist; however, when 0 is returned, it definitely does not exist.
<p>Unicode の全文字の中で Canonical Composition の先頭となる文字は数
少ないので、<a href="#mdn__unicode_compose"><em>mdn__unicode_compose</em></a> の検索のオーバヘッドを減らすためにあらかじめデータをスクリーニングする目的に
使用することができます。<br>
As there are only a small number of Unicode characters that can begin Canonical Composition, this can be used for pre-screening of data in order to decrease the search overhead of <a href="#mdn__unicode_compose"><em>mdn__unicode_compose</em></a>.
<p>

<dt><a name="mdn__unicode_toupper">mdn__unicode_toupper</a>
<dd>
<pre>
mdn_result_t
mdn__unicode_toupper(unsigned long c, mdn__unicode_context_t ctx,
	unsigned long *v, size_t vlen, int *convlenp)
</pre>
<p>Unicode文字 <var>c</var> を UnicodeData.txt の <em>Uppercase Mapping</em>
情報および SpecialCasing.txtの情報にしたがって大文字に変換し、結果を
<var>v</var> の指す領域に格納します。<var>vlen</var> はあらかじめ
<var>v</var> に確保した領域の大きさです。変換結果の文字数は
<var>*convlenp</var> に返されます。
変換結果が複数の文字になることがあることに注意してください。
またロケール依存の変換は行いません。<br>
Converts Unicode characters <var>c</var> to uppercase in accordance with the <em>Uppercase Mapping</em> information in UnicodeData.txt and SpecialCasing.txt, and stores the result in the area specified by <var>v</var>. <var>vlen</var> is the size of the area that is secured for <var>v</var> beforehand. The number of characters in the conversion result is returned to <var>*convlenp</var>. Note that the conversion result may be greater than one character and that locale-dependent conversion is not performed.

<p><var>ctx</var> は文字 <var>c</var> の出現する
<a href="#mdn__unicode_context_t">文脈情報</a>です。
ほとんどの文字では変換の際に文脈情報は不要なため、
通常は <tt>mdn__unicode_context_unknown</tt> を指定しておくことができます。
もし文脈情報が必要な場合、本関数は戻り値として <tt>mdn_context_required</tt>
を返すので、文脈情報を取得してから改めて呼び出すことが可能です。
文脈情報の取得には <a href="#mdn__unicode_getcontext">
<em>mdn__unicode_getcontext</em></a> を使用します。<br>
<var>ctx</var> is <a href="#mdn__unicode_context_t"> context information</a> where character <var>c</var> appears.
Since most characters do not require context information when they are converted, usually <tt>mdn__unicode_context_unknown</tt> can be specified.
When context information is necessary, this function returns <tt>mdn_context_required</tt> as the return value, and it is possible to call it again after obtaining the context information. To obtain context information, <a href="#mdn__unicode_getcontext"> <em>mdn__unicode_getcontext</em></a> is used.

<p>もし対応する大文字が存在しない場合には <var>c</var> がそのまま
<var>v</var> に格納されます。<br>
If no corresponding uppercase character exists, <var>c</var> is stored in <var>v</var> as is.

<p>返される値は
<tt>mdn_success</tt>、
<tt>mdn_context_required</tt>、
<tt>mdn_buffer_overflow</tt>
のいずれかです。
<p>One of the following values is returned:
<br><tt>mdn_success</tt>
<br><tt>mdn_context_required</tt>
<br><tt>mdn_buffer_overflow</tt>
<p>

<dt><a name="mdn__unicode_tolower">mdn__unicode_tolower</a>
<dd>
<pre>
mdn_result_t
mdn__unicode_tolower(unsigned long c, mdn__unicode_context_t ctx,
	unsigned long *v, size_t vlen, int *convlenp)
</pre>
<p>Unicode文字 <var>c</var> を UnicodeData.txt の <em>Uppercase Mapping</em>
情報および SpecialCasing.txtの情報にしたがって小文字に変換し、結果を
<var>v</var> の指す領域に格納します。<var>vlen</var> はあらかじめ
<var>v</var> に確保した領域の大きさです。変換結果の文字数は
<var>*convlenp</var> に返されます。
変換結果が複数の文字になることがあることに注意してください。
またロケール依存の変換は行いません。<br>
Converts Unicode character <var>c</var> to lowercase in accordance with <em>Uppercase Mapping</em> information of UnicodeData.txt and SpecialCasing.txt information, and stores the result in the area specified by <var>v</var>. <var>vlen</var> is the size of area that is secured for <var>v</var> beforehand. The number of characters of the conversion result is returned to <var>*convlenp</var>.

<p><var>ctx</var> は文字 <var>c</var> の出現する
<a href="#mdn__unicode_context_t">文脈情報</a>です。
ほとんどの文字では変換の際に文脈情報は不要なため、
通常は <tt>mdn__unicode_context_unknown</tt> を指定しておくことができます。
もし文脈情報が必要な場合、本関数は戻り値として <tt>mdn_context_required</tt>
を返すので、文脈情報を取得してから改めて呼び出すことが可能です。
文脈情報の取得には <a href="#mdn__unicode_getcontext">
<em>mdn__unicode_getcontext</em></a> を使用します。<br>
<var>ctx</var> is <a href="#mdn__unicode_context_t"> context information</a> where character <var>c</var> appears.
Since most characters do not require context information when they are converted, usually <tt>mdn__unicode_context_unknown</tt> can be specified.
When context information is necessary, this function returns <tt>mdn_context_required</tt> as the return value, and it is possible to call it again after obtaining the context information.
To obtain context information, <a href="#mdn__unicode_getcontext">
<em>mdn__unicode_getcontext</em></a> is used.

<p>もし対応する小文字が存在しない場合には <var>c</var> がそのまま
<var>v</var> に格納されます。<br>
If no corresponding uppercase character exists, <var>c</var> is stored in <var>v</var> as is.

<p>返される値は
<tt>mdn_success</tt>、
<tt>mdn_context_required</tt>、
<tt>mdn_buffer_overflow</tt>
のいずれかです。
<p>One of the following values is returned:
<br><tt>mdn_success</tt>
<br><tt>mdn_context_required</tt>
<br><tt>mdn_buffer_overflow</tt>
<p>

<dt><a name="mdn__unicode_getcontext">mdn__unicode_getcontext</a>
<dd>
<pre>
mdn__unicode_context_t
mdn__unicode_getcontext(unsigned long c)
</pre>
<p>大文字小文字変換で用いられる文脈情報を返します。
文脈情報を取得するには次のようにします。
まず大文字小文字変換の対象文字に続く次の文字を取得し、この関数を
呼び出します。もし返される値が <tt>mdn__unicode_context_final</tt>
あるいは <tt>mdn__unicode_context_nonfinal</tt> のいずれかであれば
それが求める文脈情報です。
<tt>mdn__unicode_context_unknown</tt> の場合にはさらに続く文字を取得し、
この関数を呼び出します。このようにして <tt>mdn__unicode_context_final</tt>
か <tt>mdn__unicode_context_nonfinal</tt> かいずれかの値が得られるまで
処理を繰り返します。もし文字列の最後まで来た場合には、文脈は<tt>mdn__unicode_context_final</tt> となります。<br>
Returns context information used for conversion of uppercase/lowercase characters.
To obtain context information, first the character following the uppercase/lowercase character conversion target character is obtained and this function is called. If the return value is <tt>mdn__unicode_context_final</tt> or <tt>mdn__unicode_context_nonfinal</tt>, that context information is the context information to obtain.
If <tt>mdn__unicode_context_unknown</tt> is returned, the next character is obtained and the function is called. In this way, processing continues until either the value of <tt>mdn__unicode_context_final</tt> or <tt>mdn__unicode_context_nonfinal</tt> is obtained. When processing reaches the end of the character string, <tt>mdn__unicode_context_final</tt> becomes the context.

<p>具体的にはこの関数は次のような処理を行います。
Unicode 文字 <var>c</var> の "General Category" 属性を参照し、
それが "Lu" "Ll" "Lt" のいずれかであれば
<tt>mdn__unicode_context_nonfinal</tt> を、"Mn" であれば
<tt>mdn__unicode_context_unknown</tt> を、それ以外であれば
<tt>mdn__unicode_context_final</tt> を返します。<br>
Specifically, this function does the following.
Refers "General Category" properties of Unicode character <var>c</var> and if it is "Lu", "Ll" or "Lt" <tt>mdn__unicode_context_nonfinal</tt> is returned, if it is "Mn" <tt>mdn__unicode_context_unknown</tt> is returned, and if it is other than the above, <tt>mdn__unicode_context_final</tt> is returned.

</dl>

<hr>

<h3><a name="unormalize">unormalize モジュール <br>
unormalize module</a></h3>

<p>unormalize モジュールは、Unicode で定義されている標準の正規化を
行うモジュールです。Unicode の正規化は
<a href="http://www.unicode.org/unicode/reports/tr15"><cite>Unicode Technical Report #15: Unicode Normalization Forms</cite></a>
で定義されています。本モジュールはこの文書にあげられた4つの正規化形式を
実装しています。<br>
The unormalize module performs the standard normalization defined by Unicode. Normalization of Unicode is defined in <a href="http://www.unicode.org/unicode/reports/tr15"><cite>Unicode Technical Report #15: Unicode Normalization Forms</cite></a>. This module implements the four normalization forms mentioned in this document.

<p>以下にモジュールの提供するAPI関数を示します。<br>
This module provides the following API functions.

<dl>

<dt><a name="mdn__unormalize_formc">mdn__unormalize_formc</a>
<dd>
<pre>
mdn_result_t
mdn__unormalize_formc(const char *from, char *to, size_t tolen)
</pre>
<p>UTF-8でエンコードされた文字列 <var>from</var> に対して
正規化 <em>Unicode Normalization Form C</em> を適用し、その結果を
<var>to</var> および <var>tolen</var> で指定される領域に書き込みます。<br>
Applies <em>Unicode Normalization Form C</em> normalization to a UTF-8 encoded <var>from</var> character string and writes the result in the area specified by <var>to</var> and <var>tolen</var>.
<p>返される値は
<tt>mdn_success</tt>、
<tt>mdn_invalid_encoding</tt>、
<tt>mdn_buffer_overflow</tt>、
<tt>mdn_nomemory</tt>
のいずれかです。
<p>One of the following values is returned:
<br><tt>mdn_success</tt>
<br><tt>mdn_invalid_encoding</tt>
<br><tt>mdn_buffer_overflow</tt>
<br><tt>mdn_nomemory</tt>
<p>

<dt><a name="mdn__unormalize_formd">mdn__unormalize_formd</a>
<dd>
<pre>
mdn_result_t
mdn__unormalize_formd(const char *from, char *to, size_t tolen)
</pre>
<p>UTF-8でエンコードされた文字列 <var>from</var> に対して
正規化 <em>Unicode Normalization Form D</em> を適用し、その結果を
<var>to</var> および <var>tolen</var> で指定される領域に書き込みます。<br>
Applies <em>Unicode Normalization Form D</em> normalization to a UTF-8 encoded <var>from</var> character string and writes the result in the area specified by <var>to</var> and <var>tolen</var>.
<p>返される値は
<tt>mdn_success</tt>、
<tt>mdn_invalid_encoding</tt>、
<tt>mdn_buffer_overflow</tt>、
<tt>mdn_nomemory</tt>
のいずれかです。
<p>One of the following values is returned:
<br><tt>mdn_success</tt>
<br><tt>mdn_invalid_encoding</tt>
<br><tt>mdn_buffer_overflow</tt>
<br><tt>mdn_nomemory</tt>
<p>

<dt><a name="mdn__unormalize_formkc">mdn__unormalize_formkc</a>
<dd>
<pre>
mdn_result_t
mdn__unormalize_formkc(const char *from, char *to, size_t tolen)
</pre>
<p>UTF-8でエンコードされた文字列 <var>from</var> に対して
正規化 <em>Unicode Normalization Form KC</em> を適用し、その結果を
<var>to</var> および <var>tolen</var> で指定される領域に書き込みます。<br>
Applies <em>Unicode Normalization Form KC</em> normalization to a UTF-8 encoded <var>from</var> character string and writes the result in the area specified by <var>to</var> and <var>tolen</var>.
<p>返される値は
<tt>mdn_success</tt>、
<tt>mdn_invalid_encoding</tt>、
<tt>mdn_buffer_overflow</tt>、
<tt>mdn_nomemory</tt>
のいずれかです。
<p>One of the following values is returned:
<br><tt>mdn_success</tt>
<br><tt>mdn_invalid_encoding</tt>
<br><tt>mdn_buffer_overflow</tt>
<br><tt>mdn_nomemory</tt>
<p>

<dt><a name="mdn__unormalize_formkd">mdn__unormalize_formkd</a>
<dd>
<pre>
mdn_result_t
mdn__unormalize_formkd(const char *from, char *to, size_t tolen)
</pre>
<p>UTF-8でエンコードされた文字列 <var>from</var> に対して
正規化 <em>Unicode Normalization Form KD</em> を適用し、その結果を
<var>to</var> および <var>tolen</var> で指定される領域に書き込みます。<br>
Applies <em>Unicode Normalization Form KC</em> normalization to a UTF-8 encoded <var>from</var> character string and writes the result in the area specified by <var>to</var> and <var>tolen</var>.
<p>返される値は
<tt>mdn_success</tt>、
<tt>mdn_invalid_encoding</tt>、
<tt>mdn_buffer_overflow</tt>、
<tt>mdn_nomemory</tt>
のいずれかです。
<p>One of the following values is returned:
<br><tt>mdn_success</tt>
<br><tt>mdn_invalid_encoding</tt>
<br><tt>mdn_buffer_overflow</tt>
<br><tt>mdn_nomemory</tt>
</dl>

<hr>

<h3><a name="utf5">utf5 モジュール <br>
utf5 module</a></h3>

<p>utf5 モジュールはドメイン名のエンコーディング方式の一つとして
提案されている
<a href="../../reference/draft/draft-jseng-utf5-01.txt">UTF-5 エンコーディング</a> 
の基本処理を行うモジュールです。<br>
The utf5 module performs basic processing for the proposed <a href="../../reference/draft/draft-jseng-utf5-01.txt">UTF-5 </a> domain name encoding system.

<p>以下にモジュールの提供するAPI関数を示します。<br>
This module provides the following API functions.

<dl>

<dt><a name="mdn_utf5_getwc">mdn_utf5_getwc</a>
<dd>
<pre>
int
mdn_utf5_getwc(const char *s, size_t len,
	unsigned long *vp)
</pre>
<p>UTF-5でエンコードされた長さ <var>len</var> バイトの文字列 <var>s</var> の
先頭の文字を取り出し、UCS-4 に変換して <var>vp</var> の指す領域に格納すると
ともに、文字の (UTF-5エンコードでの) バイト数を返します。
もし <var>len</var> が短すぎて文字の途中で終わっていたり、エンコーディングが
間違っている場合には 0 が返されます。<br>
Extracts the leading character of length <var>len</var> byte UTF-5 encoded character string <var>s</var>, converts it to UCS-4 and stores it in the area specified by <var>vp</var> and also returns the number of bytes in the (UTF-5 encoded) character strintg. 0 is returned if <var>len</var> is too short and ends in the middle of a character or the encoding is invalid.
<p>

<dt><a name="mdn_utf5_putwc">mdn_utf5_putwc</a>
<dd>
<pre>
int
mdn_utf5_putwc(char *s, size_t len, unsigned long v)
</pre>
<p>UCS-4 文字 <var>v</var> をUTF-5エンコーディングに変換し、<var>s</var>
および <var>len</var> で指定される領域に書き込むとともに、書き込んだバイト数を
返します。ただし <var>len</var> が短すぎて書き込めない場合には0を返します。<br>
Converts UCS-4 characters <var>v</var> to UTF-5 encoding, writes them in the area specified by <var>s</var> and <var>len</var> and returns the number of bytes written. 0 is returned if <var>len</var> is too short to write.
<p>書き込んだUTF-5文字列は<strong>NULL 文字で終端されていません</strong>。<br>
The written UTF-5 character string is <strong>not terminated with a NULL character</strong>.

</dl>

<hr>

<h3><a name="utf8">utf8 モジュール <br>
utf8 module</a></h3>

<p>utf8 モジュールはUTF-8 でエンコードされた文字列の基本処理を行う
モジュールです。<br>
The utf8 module performs the basic processing of UTF-8 encoded character strings.

<p>以下にモジュールの提供するAPI関数を示します。<br>
This module provides the following API functions.

<dl>

<dt><a name="mdn_utf8_mblen">mdn_utf8_mblen</a>
<dd>
<pre>
int
mdn_utf8_mblen(const char *s)
</pre>
<p>UTF-8 文字列 <var>s</var> の先頭文字の長さ(バイト数)を返します。
もし <var>s</var> が指すバイトが UTF-8 の先頭バイトとして正しくないものである
場合には 0 を返します。<br>
Returns the length (number of bytes) of the leading character in the UTF-8 character string <var>s</var>. 0 is returned if the leading byte indicated by <var>s</var> is not valid for UTF-8.
<p>この関数は <var>s</var> の先頭バイトのみを調べて長さを返します。したがって
2バイト目以降に不正なバイトがある可能性が存在します。特に途中に NULL バイトが
ある可能性もあるので、<var>s</var> が正当な UTF-8 文字列であることが確実では
ない場合には気をつける必要があります。<br>
This function returns the length by checking the leading byte of <var>s</var>; there is therefore a possibility of invalid byte in the 2nd and later byte. In particular, NULL bytes may exist in the middle, so you have to be careful when it is not certain that <var>s</var> is a valid UTF-8 character string.
<p>

<dt><a name="mdn_utf8_getmb">mdn_utf8_getmb</a>
<dd>
<pre>
int
mdn_utf8_getmb(const char *s, size_t len, char *buf)
</pre>
<p>長さ <var>len</var> バイトの UTF-8 文字列 <var>s</var> の先頭の1文字を<var>buf</var> にコピーし、コピーしたバイト数を返します。もし <var>len</var> が短すぎたり、<var>s</var> が指す文字が UTF-8 として正しくない場合にはコピーは行わず、0 を返します。<br>
Copies the leading character of <var>s</var> UTF-8 character strings of length <var>len</var> and returns the number of copied bytes.
<p><var>buf</var> は任意の UTF-8 エンコーディングの文字が保持できる大きさ
でなければなりません。すなわち、6バイト以上の長さを持っている必要があります。<br>
<var>buf</var> must be large enough to hold any UTF-8 encoding, i.e. it must be 6 bytes or larger. 
<p>書き込んだUTF-8文字列は <strong>NULL 文字で終端されていません</strong>。<br>
The written UTF-8 character string is <strong> not terminated with a NULL character</strong>.
<p>

<dt><a name="mdn_utf8_getwc">mdn_utf8_getwc</a>
<dd>
<pre>
int
mdn_utf8_getwc(const char *s, size_t len,
	unsigned long *vp)
</pre>
<p><a href="#mdn_utf8_getmb"><em>mdn_utf8_getmb</em></a> とほぼ同じですが、
<var>s</var> から取り出した文字を
UCS-4に変換して <var>vp</var> の指す領域に格納するところが異なります。<br>
This is almost same as <a href="#mdn_utf8_getmb"><em>mdn_utf8_getmb</em></a> with the difference being that characters extracted from <var>s</var> are converted to UCS-4 and stored in the area indicated by <var>vp</var>.
<p>

<dt><a name="mdn_utf8_putwc">mdn_utf8_putwc</a>
<dd>
<pre>
int
mdn_utf8_putwc(char *s, size_t len, unsigned long v)
</pre>
<p>UCS-4 文字 <var>v</var> を UTF-8 エンコーディングに変換して、
<var>s</var> および <var>len</var> で指定される領域に書き込むとともに、
書き込んだバイト数を返します。<var>v</var> の値が不正であったり
<var>len</var> が短すぎた場合には 0 を返します。<br>
Converts UCS-4 character <var>v</var> to UTF-8 encoding, writes it in the area specified by <var>s</var> and <var>len</var> and returns the number of written bytes. 0 is returned when the value of <var>v</var> is invalid or <var>len</var> is too short.
<p>書き込んだUTF-8文字列は NULL 文字で終端されていません</strong>。<br>
The written UTF-8 character string is <strong>not terminated with a NULL character</strong>.
<p>

<dt><a name="mdn_utf8_isvalidstring">mdn_utf8_isvalidstring</a>
<dd>
<pre>
int
mdn_utf8_isvalidstring(const char *s)
</pre>
<p>NULL 文字で終端された文字列 <var>s</var> が正しい UTF-8 エンコーディング
であるかどうか調べ、正しければ 1 を、正しくなければ 0 を返します。<br>
Checks whether or not character string <var>s</var> terminated with a NULL character is valid UTF-8 encoding and returns 1 if so and 0 if not.
<p>

<dt><a name="mdn_utf8_findfirstbyte">mdn_utf8_findfirstbyte</a>
<dd>
<pre>
char *
mdn_utf8_findfirstbyte(const char *s,
	const char *known_top)
</pre>
<p>文字列 <var>known_top</var> 中の <var>s</var> が指すバイトを含む
UTF-8 文字の先頭バイトを調べて返します。その文字が正しい UTF-8 
エンコーディングではない場合、<var>known_top</var> から <var>s</var> までの
間に先頭バイトがなかった場合には NULL を返します。<br>
In the character string <var>known_top</var>, checks the leading byte of UTF-8 characters including the byte indicated by <var>s</var> and returns it. NULL is returned if there are any incorrectly encoded UTF-8 characters or there is no leading byte between <var>known_top</var> and <var>s</var>.

</dl>

<hr>

<h3><a name="util">util モジュール util module</a></h3>

<p>util モジュールは他のモジュールで使われるユーティリティー的な
機能を提供するモジュールです。
現在のところは大文字小文字の区別をしない文字列照合の機能のみを
提供しています。<br>
The util module provides utility type functions used by other modules. The only function currently provided is a character string collation function that does not differentiate between uppercase and lowercase characters.

<p>以下にモジュールの提供するAPI関数を示します。<br>
This module provides the following API functions.

<dl>
<dt><a name="mdn_util_casematch">mdn_util_casematch</a>
<dd>
<pre>
int
mdn_util_casematch(const char *s1, const char *s2, size_t n)
</pre>
<p>文字列 <var>s1</var> と <var>s2</var> の先頭から最大 <var>n</var> バイトを
比較し、同一かどうかを判定します。
ASCII 文字の大文字と小文字 (つまり A から Z と a から z) は同一とみなします。
同一であれば 1 を、違っていれば 0 を返します。
これは多くのシステムで用意されている <em>strcasencmp</em> と返り値の仕様を
除けばほぼ同様の機能を提供する関数です。<br>
Compares the maximum <var>n</var> bytes from the beginning of character strings <var>s1</var> and <var>s2</var> and determines whether or not they are identical. Uppercase and lowercase ASCII characters (i.e. A to Z and a to z) are assumed to be the same. 1 is returned if they are found to be identical and 0 is returned if not. With the exception of the return value specifications, this function provides almost the same features as <em>strcasencmp</em>, which is provided in many systems.
</dl>
<p>

<hr>

<h3><a name="ZLDrule">ZLDrule モジュール ZLDrule module</a></h3>

<p>ZLDrule モジュールはドメイン名と ZLD とのマッチングを行うモジュールです。
ドメイン名に使用される可能性のある ZLD のリストとそれぞれの ZLD に対応した
エンコーディングのリストを持ち、与えられたドメイン名とのマッチングを行って
マッチした ZLD とエンコーディングを返します。<br>
The ZLDrule module matches the domain name and ZLD. It has a list of ZLDs that are probably used for domain names and the list of encodings corresponding to each ZLD, and performs matching with the given doman name, then returns the matched ZLD and encoding.

<p>ZLDrule モジュールはマッチングのために「コンテキスト」という概念を用います。
マッチングに先立ってまずコンテキストを作成し、それに対して
ZLD とエンコーディングを登録していきます。
そして実際にドメイン名とマッチングを行う際にはこのコンテキストを用いて
マッチングに使用するZLD とエンコーディングのリストを指定します。
コンテキストの型は
<em>mdn_ZLDrule_t</em> 型であり、次のような opaque 型として定義されています。<br>
The ZLDrule module uses "context" concept for matching. Prior to matching, a context is created and ZLD and encoding are registered for the context. When domain name matching is performed, this context is used to specify the ZLD and encoding lists used for matching. The type of context is <em>mdn_ZLDrule_t</em> and is defined as the following opaque type.

<blockquote>
<pre>
typedef struct mdn_ZLDrule *mdn_ZLDrule_t;
</pre>
</blockquote>

<p>以下にモジュールの提供するAPI関数を示します。<br>
This module provides the following API functions.

<dl>

<dt><a name="mdn_ZLDrule_create">mdn_ZLDrule_create</a>
<dd>
<pre>
mdn_result_t
mdn_ZLDrule_create(mdn_ZLDrule_t *ctxp)
</pre>
<p>ZLDのマッチングを行うためのコンテキストを作成し、
<var>ctxp</var> の指す領域に格納します。<br>
Creates a context for ZLD matching and stores it in the area indicated by <var>ctxp</var>.
<p>返される値は
<tt>mdn_success</tt>、
<tt>mdn_nomemory</tt>
のいずれかです。
<p>One of the following values is returned:
<br><tt>mdn_success</tt>
<br><tt>mdn_nomemory</tt>
<p>

<dt><a name="mdn_ZLDrule_destroy">mdn_ZLDrule_destroy</a>
<dd>
<pre>
void
mdn_ZLDrule_destroy(mdn_ZLDrule_t ctx)
</pre>
<p><a href="#mdn_ZLDrule_create"><em>mdn_ZLDrule_create</em></a> で作成した
コンテキスト <var>ctx</var> を削除し、確保したメモリを解放します。<br>
Deletes the context created by <a href="#mdn_ZLDrule_create"><em>mdn_ZLDrule_create</em></a> and releases the allocated memory.
<p>

<dt><a name="mdn_ZLDrule_add">mdn_ZLDrule_add</a>
<dd>
<pre>
mdn_result_t
mdn_ZLDrule_add(mdn_ZLDrule_t ctx, const char *ZLD,
	const char **encodings, int nencodings)
</pre>
<p><a href="#mdn_ZLDrule_create"><em>mdn_ZLDrule_create</em></a> で作成した
コンテキスト <var>ctx</var> に、ZLD <var>ZLD</var> と
<var>encodings</var> および <var>nencodings</var> で指定される
エンコーディングリストの組を登録します。<br>
Registers the <var>ZLD</var> and encoding list set specified by <var>encodings</var> and <var>nencodings</var> in context <var>ctx</var> created by <a href="#mdn_ZLDrule_create"><em>mdn_ZLDrule_create</em></a>.
<p>空の ZLD、つまり "" や "." は任意のドメイン名にマッチします。
したがってZLDとして空の値を指定することによって、いずれの
ZLD にもマッチしなかった場合のデフォルトのエンコーディングを指定することが
可能です。<br>
Empty ZLDs such as "" or "." match all domain names, therefore, by specifying an empty value for ZLD the default encoding can be specified in those cases in which no ZLD match is found.
<p>返される値は
<tt>mdn_success</tt>、
<tt>mdn_nomemory</tt>
のいずれかです。
<p>One of the following values is returned:
<br><tt>mdn_success</tt>
<br><tt>mdn_nomemory</tt>
<p>

<dt><a name="mdn_ZLDrule_select">mdn_ZLDrule_select</a>
<dd>
<pre>
mdn_result_t
mdn_ZLDrule_select(mdn_ZLDrule_t ctx, const char *domain,
	char **ZLDp, mdn_converter_t *convctxp)
</pre>
<p>コンテキスト <var>ctx</var> に含まれている ZLD のリストと
ドメイン名 <var>domain</var> とのマッチングを試みます。マッチングは
ZLDが長い (ZLD を構成するラベルの数が多い) ものから順に行われます。<br>
Attempts to match the ZLD list contained in context <var>ctx</var> and domain name <var>domain</var>. Matching is executed starting from the longest ZLD (a ZLD consisting of many labels).
<p>マッチするZLDがあった場合、<var>ZLDp</var> の指す領域に、マッチした
ZLD へのポインタが格納されます。返されるポインタはすでに
<a href="#mdn_translator_canonicalZLD"><em>mdn_translator_canonicalZLD</em></a>
によって標準形式になっているので、そのまま
<a href="#mdn_translator_translate"><em>mdn_translator_translate</em></a> への
引数として渡すことができます。<br>
When a ZLD match is found, the pointer to the ZLD match is stored in the area specified by <var>ZLDp</var>. Since the return pointer has already been converted to the standard form by <a href="#mdn_translator_canonicalZLD"><em>mdn_translator_canonicalZLD</em></a>, it can be passed as the argument as is.
<p>マッチしたZLD に対応するエンコーディングが一つだけなら、そのエンコーディング
に対応するコード変換コンテキストが <var>convctxp</var> の指す領域に
格納されます。
対応するエンコーディングが複数あれば、リストの先頭から順に
<var>domain</var> がそのエンコーディングとして正しいかどうかを調べます。
もし正しいものがあれば、最初に見つかったもののコード変換コンテキストが
<var>convctxp</var> の指す領域に格納されます。正しいものがなければ
<var>convctxp</var> には何も書き込まれず、<tt>mdn_invalid_encoding</tt>が
返されます。<br>
When only one encoding method corresponds to the matched ZLD, the code conversion context corresponding to that encoding method is stored in the area specified by <var>convctxp</var>. If there is more than one valid encoding method, a check is performed from the top of the list to determine whether or not <var>domain</var> is valid for the encoding. Of the valid encoding methods found, the code conversion context of the first one found is stored in the area specified by <var>convctxp</var>. If no valid encoding method is found, nothing is written in <var>convctxp</var> and <tt>mdn_invalid_encoding</tt> is returned.
<p>マッチする ZLD がなければ <tt>mdn_notfound</tt>を返して処理を終了します。<br>When there is no ZLD match, <tt>mdn_notfound</tt> is returned and processing ends.
<p>返される値は
<tt>mdn_success</tt>、
<tt>mdn_notfound</tt>、
<tt>mdn_invalid_encoding</tt>
のいずれかです。
<p>One of the following values is returned:
<br><tt>mdn_success</tt>
<br><tt>mdn_notfound</tt>
<br><tt>mdn_invalid_encoding</tt>

</dl>

</body>
</html>
